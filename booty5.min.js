/**
 * author       Mat Hopwood
 * copyright    2015 Mat Hopwood
 * More info    http://booty5.com
 */
"use strict";var b5={};b5.app=null;b5.data={};b5.version=1.52;(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());"use strict";b5.Ease=function Ease(){};b5.Ease.linear=0;b5.Ease.quadin=1;b5.Ease.quadout=2;b5.Ease.cubicin=3;b5.Ease.cubicout=4;b5.Ease.quartin=5;b5.Ease.quartout=6;b5.Ease.sin=7;b5.Ease.easingFuncs=[function(a){return a},function(a){return a*a},function(a){return a*(2-a)},function(a){return a*a*a},function(a){a-=1;return a*a*a+1},function(a){return a*a*a*a},function(a){a-=1;return -(a*a*a*a-1)},function(a){return Math.sin(a*Math.PI/2)}];"use strict";b5.Animation=function(a,d,c,f,e,b,g){this.timeline=a;this.state=b5.Animation.AS_playing;this.time=-0.000001;this.repeats_left=b;this.index=-1;this.name=null;this.target=d;this.property=c;this.frames=f;this.times=e;this.easing=g;this.repeat=b;this.destroy=true;this.actions=[];this.time_scale=1;this.tween=true};b5.Animation.AS_playing=0;b5.Animation.AS_paused=1;b5.Animation.prototype.pause=function(){this.state=b5.Animation.AS_paused};b5.Animation.prototype.play=function(){this.state=b5.Animation.AS_playing};b5.Animation.prototype.restart=function(){this.state=b5.Animation.AS_playing;this.time=-0.000001;this.index=-1;this.repeats_left=this.repeat};b5.Animation.prototype.update=function(c){if(this.state!==b5.Animation.AS_playing){return}c*=this.time_scale;var d=this.time+c;var a=this.times;var l=this.frames;var k=a.length;var b=this.index;if(k<=1){return}for(var o=b;o<k;o++){var i=a[o];if(d<i){this.index=o;if(d>=a[0]){if(this.index!==b){var f=this.actions[this.index-1];if(f!==undefined){f()}}var h=a[o-1];var g=l[o-1];var n=d-h;if(n!==0){if(this.tween){var j=i-h;var m=l[o]-g;if(this.easing!==undefined){this.target[this.property]=g+m*b5.Ease.easingFuncs[this.easing[o-1]](n/j)}else{this.target[this.property]=g+(m*n)/j}}else{this.target[this.property]=g}}}break}}var e=a[a.length-1];if(d>e){if(this.repeat>0){this.repeats_left--}if(this.repeat===0||this.repeats_left>0){while(d>=e){d-=e}if(this.onRepeat!==undefined){this.onRepeat(this)}this.target[this.property]=l[0]}else{this.target[this.property]=l[a.length-1];this.state=b5.Animation.AS_paused;if(this.onEnd!==undefined){this.onEnd(this)}if(this.destroy){this.timeline.remove(this)}}this.index=-1}this.time=d};b5.Animation.prototype.setTime=function(a){this.time=a;this.index=-1;this.update(0)};b5.Animation.prototype.setAction=function(b,a){this.actions[b]=a};"use strict";b5.Timeline=function(c,b,e,d,a,f){this.anims=[];this.manager=null;this.name=null;if(c!==undefined){this.add(c,b,e,d,a,f)}};b5.Timeline.prototype.add=function(d,c,f,e,b,g){if(arguments.length==1){d.timeline=this;this.anims.push(d);return d}var a=new b5.Animation(this,d,c,f,e,b,g);this.anims.push(a);return a};b5.Timeline.prototype.remove=function(d){var a=this.anims;var c=a.length;for(var b=0;b<c;b++){if(a[b]===d){a.splice(b,1);return}}};b5.Timeline.prototype.find=function(b){var a=this.anims;var d=a.length;for(var c=0;c<d;c++){if(a[c].name===b){return a[c]}}return null};b5.Timeline.prototype.pause=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].pause()}};b5.Timeline.prototype.play=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].play()}};b5.Timeline.prototype.restart=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].restart()}};b5.Timeline.prototype.print=function(){var b=this.anims.length;for(var a=0;a<b;a++){console.log(this.anims[a])}};b5.Timeline.prototype.update=function(c){var b=this.anims.length;if(b===0&&this.manager!==undefined){this.manager.remove(this);return}for(var a=b-1;a>=0;a--){this.anims[a].update(c)}};"use strict";b5.TimelineManager=function(){this.timelines=[]};b5.TimelineManager.prototype.add=function(a){this.timelines.push(a);a.manager=this;return a};b5.TimelineManager.prototype.remove=function(d){var b=this.timelines;var c=b.length;for(var a=0;a<c;a++){if(b[a]===d){b.splice(a,1);return}}};b5.TimelineManager.prototype.find=function(a){var c=this.timelines;var d=c.length;for(var b=0;b<d;b++){if(c[b].name===a){return c[b]}}return null};b5.TimelineManager.prototype.pause=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].pause()}};b5.TimelineManager.prototype.play=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].play()}};b5.TimelineManager.prototype.restart=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].restart()}};b5.TimelineManager.prototype.print=function(){var b=this.timelines.length;for(var a=0;a<b;a++){console.log(this.timelines[a])}};b5.TimelineManager.prototype.update=function(c){var b=this.timelines.length;for(var a=b-1;a>=0;a--){this.timelines[a].update(c)}};"use strict";b5.ActionsRegister={creators:[],register:function(a,b){b5.ActionsRegister.creators[a]=b},create:function(a,b){return b5.ActionsRegister.creators[a](b)}};b5.ActionsList=function(a,b){this.repeats_left=b;this.manager=null;this.name=a;this.repeat=b;this.actions=[];this.current=0;this.destroy=true;this.playing=false};b5.ActionsList.prototype.add=function(a){this.actions.push(a);a.parent=this;return a};b5.ActionsList.prototype.remove=function(c){var d=this.actions;var b=d.length;for(var a=0;a<b;a++){if(d[a]===c){d.splice(a,1);return}}};b5.ActionsList.prototype.execute=function(){if(!this.playing){return true}var c=this.actions;var a=c.length;if(a===0){return false}var b=c[this.current];if(b.initialised!==true){if(b.onInit!==undefined){b.onInit()}b.initialised=true}if(b.onTick===undefined||!b.onTick()){b.initialised=false;this.current++;if(this.current>=a){this.current=0;if(this.repeat!==0){this.repeats_left--;if(this.repeats_left<=0){this.playing=false;this.repeats_left=this.repeat;return false}}}}return true};b5.ActionsList.prototype.pause=function(){this.playing=false};b5.ActionsList.prototype.play=function(){this.playing=true};b5.ActionsList.prototype.restart=function(){var c=this.actions;var b=c.length;for(var a=0;a<b;a++){c[a].initialised=false}this.repeats_left=this.repeat;this.play()};b5.ActionsListManager=function(){this.actions=[]};b5.ActionsListManager.prototype.add=function(a){this.actions.push(a);a.manager=this;return a};b5.ActionsListManager.prototype.remove=function(c){var d=this.actions;var b=d.length;for(var a=0;a<b;a++){if(d[a]===c){d.splice(a,1);return}}};b5.ActionsListManager.prototype.find=function(a){var d=this.actions;var c=d.length;for(var b=0;b<c;b++){if(d[b].name===a){return d[b]}}return null};b5.ActionsListManager.prototype.execute=function(){var b=[];var d=this.actions;var c=d.length;for(var a=0;a<c;a++){if(!d[a].execute()){if(d[a].destroy){b.push(d[a])}}}for(var a=0;a<b.length;a++){this.remove(b[a])}};"use strict";b5.EventsManager=function(){this.events=[]};b5.EventsManager.prototype.on=function(c,b,a){this.events.push({name:c,func:b,data:a})};b5.EventsManager.prototype.remove=function(c){var a=this.events;var b=a.length;this.events=array.filter(function(d){return d.name!==c})};b5.EventsManager.prototype.clear=function(){this.events=[]};b5.EventsManager.prototype.dispatch=function(d){var b=this.events;var c=b.length;for(var a=0;a<c;a++){if(b[a].name===d){b[a].func(b[a]);return}}};"use strict";b5.Task=function(b,a,e,c,d){this.name=b;this.func=c;this.data=d;this.state=b5.Task.Stopped;this.running_time=0;this.delay=a;this.loops=0;this.repeat=e;this.last_time=0;this.wait=0;this.pause=function(){this.state=b5.Task.Paused};this.play=function(){this.state=b5.Task.Running};this.stop=function(){this.state=b5.Task.Stopped};if(a===0){this.play()}else{if(a>0){this.state=b5.Task.Dormant}}};b5.Task.Dormant=0;b5.Task.Running=1;b5.Task.Paused=2;b5.Task.Stopped=3;b5.TasksManager=function(){this.tasks=[]};b5.TasksManager.prototype.add=function(f,e,c,b,a){var d=new b5.Task(f,e,c,b,a);this.tasks.push(d);return d};b5.TasksManager.prototype.remove=function(c){var d=this.tasks;var b=d.length;for(var a=0;a<b;a++){if(d[a].name===c){d.splice(a,1);return}}};b5.TasksManager.prototype.removeTask=function(a){var d=this.tasks;var c=d.length;for(var b=0;b<c;b++){if(d[b]===a){d.splice(b,1);return}}};b5.TasksManager.prototype.find=function(c){var d=this.tasks;var b=d.length;for(var a=0;a<b;a++){if(d[a].name===c){return d[a]}}return null};b5.TasksManager.prototype.clear=function(){this.tasks=[]};b5.TasksManager.prototype.execute=function(){var c=[];var e=b5.app.dt;var g=this.tasks;var d=g.length;for(var b=0;b<d;b++){var a=g[b];if(a.state===b5.Task.Dormant){a.running_time+=e;if(a.running_time>=a.delay){a.play();a.running_time-=e}}if(a.state===b5.Task.Running){var f=true;if(a.wait!==0){a.last_time+=e;if(a.last_time>=a.wait){a.last_time-=a.wait}else{f=false}}if(f===true){a.func(a);a.running_time+=e;if(a.repeat>0){a.loops++;if(a.loops>=a.repeat){c.push(a);a.stop()}}}}}for(var b=0;b<c.length;b++){this.removeTask(c[b])}};"use strict";b5.Actor=function(a){this.type=b5.Actor.Type_Image;this.scene=null;this.parent=null;this.actors=[];this.removals=[];this.joints=[];this.timelines=new b5.TimelineManager();this.actions=new b5.ActionsListManager();this.tasks=new b5.TasksManager();this.frame_count=0;this.accum_scale_x=1;this.accum_scale_y=1;this.accum_opacity=1;this.body=null;this.transform=[];this.transform_dirty=true;this.touching=false;this.touchmove=false;this.layer=0;this.order_changed=true;this.cache_canvas=null;this.name="";this.tag="";this.id=-1;this.active=true;this.visible=true;this.touchable=false;this.layer=0;this.x=0;this.y=0;this.w=0;this.h=0;this.ox=0;this.oy=0;this.ignore_atlas_size=false;this.absolute_origin=true;this.rotation=0;this.scale_x=1;this.scale_y=1;this.depth=0;this.opacity=1;this.use_parent_opacity=true;this.current_frame=0;this.prev_frame=0;this.frame_speed=0;this.anim_frames=null;this.bitmap=null;this.atlas=null;this.vr=0;this.vx=0;this.vy=0;this.vd=0;this.vr_damping=1;this.vx_damping=1;this.vy_damping=1;this.vd_damping=1;this.ignore_camera=false;this.wrap_position=false;this.dock_x=0;this.dock_y=0;this.margin=[0,0,0,0];this.bubbling=false;this.clip_children=false;this.clip_margin=[0,0,0,0];this.clip_shape=null;this.self_clip=false;this.orphaned=false;this.virtual=false;this.shadow=false;this.shadow_x=0;this.shadow_y=0;this.shadow_blur=0;this.shadow_colour="#000000";this.composite_op=null;this.cache=false;this.merge_cache=false;this.round_pixels=false;if(a===true){this.makeVirtual()}};b5.Actor.Dock_None=0;b5.Actor.Dock_Top=1;b5.Actor.Dock_Bottom=2;b5.Actor.Dock_Left=1;b5.Actor.Dock_Right=2;b5.Actor.Type_Image=0;b5.Actor.Type_Label=1;b5.Actor.Type_Rect=2;b5.Actor.Type_Arc=3;b5.Actor.Type_Polygon=4;b5.Actor.Type_Particle=5;b5.Actor.Type_Map=6;Object.defineProperty(b5.Actor.prototype,"_x",{get:function(){return this.x},set:function(a){if(this.x!==a){this.x=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_y",{get:function(){return this.y},set:function(a){if(this.y!==a){this.y=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_ox",{get:function(){return this.ox},set:function(a){if(this.ox!==a){this.ox=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_oy",{get:function(){return this.oy},set:function(a){if(this.oy!==a){this.oy=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_rotation",{get:function(){return this.rotation},set:function(a){if(this.rotation!==a){this.rotation=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_scale_x",{get:function(){return this.scale_x},set:function(a){if(this.scale_x!==a){this.scale_x=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_scale_y",{get:function(){return this.scale_y},set:function(a){if(this.scale_y!==a){this.scale_y=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_scale",{set:function(a){this._scale_x=a;this._scale_y=a}});Object.defineProperty(b5.Actor.prototype,"_depth",{get:function(){return this.depth},set:function(a){if(this.depth!==a){this.depth=a;this.dirty()}}});Object.defineProperty(b5.Actor.prototype,"_layer",{get:function(){return this.layer},set:function(a){if(this.layer!==a){this.layer=a;if(this.parent!==null){this.parent.order_changed=true}else{this.scene.order_changed=true}}}});Object.defineProperty(b5.Actor.prototype,"_atlas",{get:function(){return this.atlas},set:function(a){if(this.atlas!==a){this.atlas=b5.Utils.resolveResource(a,"brush")}}});Object.defineProperty(b5.Actor.prototype,"_bitmap",{get:function(){return this.bitmap},set:function(a){if(this.bitmap!==a){this.bitmap=b5.Utils.resolveResource(a,"bitmap")}}});Object.defineProperty(b5.Actor.prototype,"_clip_shape",{get:function(){return this.clip_shape},set:function(a){if(this.clip_shape!==a){this.clip_shape=b5.Utils.resolveResource(a,"shape")}}});b5.Actor.prototype.setPosition=function(a,d){if(this.x!==a||this.y!==d){this.x=a;this.y=d;this.dirty();if(this.body!==null){var c=Box2D.Common.Math.b2Vec2;var b=this.scene.world_scale;this.body.SetPosition(new c(a/b,d/b))}}};b5.Actor.prototype.setPositionPhysics=function(a,b){this.setPosition(a,b)};b5.Actor.prototype.setOrigin=function(a,b){if(this.ox!==a||this.oy!==b){this.ox=a;this.oy=b;this.dirty()}};b5.Actor.prototype.setScale=function(a,b){if(this.scale_x!==a||this.scale_y!==b){this.scale_x=a;this.scale_y=b;this.dirty()}};b5.Actor.prototype.setRotation=function(a){if(this.rotation!==a){this.rotation=a;this.dirty();if(this.body!==null){this.body.SetAngle(a)}}};b5.Actor.prototype.setRotationPhysics=function(a){this.setRotation(a)};b5.Actor.prototype.setDepth=function(a){if(this.depth!==a){this.depth=a;this.dirty()}};b5.Actor.prototype.playAnim=function(a){if(this.atlas!==null){var b=this.atlas.getAnim(a);if(b!==null){this.current_frame=0;this.anim_frames=b.indices;this.frame_speed=b.speed;this.dirty()}else{if(this.app.debug){console.log("Warning: Could not find brush anim '"+a+"' for actor '"+this.name+"'")}}}};b5.Actor.prototype.release=function(){if(this.onDestroy!==undefined){this.onDestroy()}this.releaseJoints();this.releaseBody()};b5.Actor.prototype.destroy=function(){if(this.parent!==null){this.parent.removeActor(this)}else{if(this.scene!==null){this.scene.removeActor(this)}}};b5.Actor.prototype.changeParent=function(c){var a;if(this.parent!==null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;for(var b=0;b<d;b++){if(this===a[b]){a.splice(b,1);c.addActor(this);break}}};b5.Actor.prototype.addActor=function(a){this.actors.push(a);a.parent=this;a.scene=this.scene;return a};b5.Actor.prototype.removeActor=function(a){this.removals.push(a)};b5.Actor.prototype.removeActorsWithTag=function(a){var b=this.actors;var e=b.length;var d=this.removals;for(var c=0;c<e;c++){if(b[c].tag===a){d.push(b[c])}}};b5.Actor.prototype.cleanupDestroyedActors=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.actors;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g===a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};b5.Actor.prototype.findActor=function(d,c){if(c===undefined){c=false}var b=this.actors;var f=b.length;for(var e=0;e<f;e++){if(b[e].name===d){return b[e]}else{if(c){var a=b[e].findActor(d,c);if(a!==null){return a}}}}return null};b5.Actor.prototype.findActorById=function(f,c){if(c===undefined){c=false}var b=this.actors;var e=b.length;for(var d=0;d<e;d++){if(b[d].id===f){return b[d]}else{if(c){var a=b[d].findActorById(f,c);if(a!==null){return a}}}}return null};b5.Actor.prototype.findFirstParent=function(){var a=this;while(a!==null){if(a.parent===null){return a}a=a.parent}return null};b5.Actor.prototype.findFirstCachedParent=function(){var a=this.parent;while(a!==null){if(a.cache_canvas!==null){return a}a=a.parent}return null};b5.Actor.prototype.updateParentTransforms=function(){var a=[];var c=this;while(c!==null){a.push(c);c=c.parent}for(var b=a.length-1;b>=0;b--){a[b].updateTransform()}};b5.Actor.prototype.bringToFront=function(){var a;if(this.parent!==null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]===this){c=b;break}}if(c>=0){a.splice(c,1);a.push(this)}};b5.Actor.prototype.sendToBack=function(){var a;if(this.parent!==null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]===this){c=b;break}}if(c>=0){a.splice(c,1);a.unshift(this)}};b5.Actor.prototype.onBeginTouchBase=function(a){this.touching=true;if(this.bubbling&&this.parent!==null){this.parent.onBeginTouchBase(a)}if(this.onBeginTouch!==undefined){this.onBeginTouch(a)}};b5.Actor.prototype.onEndTouchBase=function(a){if(this.touching&&this.onTapped!==undefined){this.onTapped(a)}this.touching=false;this.touchmove=false;if(this.bubbling&&this.parent!==null){this.parent.onEndTouchBase(a)}if(this.onEndTouch!==undefined){this.onEndTouch(a)}};b5.Actor.prototype.onMoveTouchBase=function(a){this.touchmove=true;if(this.bubbling&&this.parent!==null){this.parent.onMoveTouchBase(a)}if(this.virtual){this.Virtual_onMoveTouch(a)}if(this.onMoveTouch!==undefined){this.onMoveTouch(a)}};b5.Actor.prototype.releaseBody=function(){if(this.body!==null){this.scene.world.DestroyBody(this.body);this.body=null}};b5.Actor.prototype.releaseJoints=function(){if(this.body!==null){for(var a=0;a<this.joints.length;a++){this.scene.world.DestroyJoint(this.joints[a])}this.joints=null}};b5.Actor.prototype.initBody=function(c,d,a){if(!this.scene.app.box2d){return null}var e=this.scene;var f=new Box2D.Dynamics.b2BodyDef;var b=e.world_scale;if(c==="static"){f.type=Box2D.Dynamics.b2Body.b2_staticBody}else{if(c==="kinematic"){f.type=Box2D.Dynamics.b2Body.b2_kinematicBody}else{f.type=Box2D.Dynamics.b2Body.b2_dynamicBody}}f.position.Set(this.x/b,this.y/b);f.angle=this.rotation;f.fixedRotation=d;f.bullet=a;this.body=e.world.CreateBody(f);this.body.SetUserData(this);return this.body};b5.Actor.prototype.addFixture=function(n){if(this.body===null){return null}var b;var e=n;var d=n;if(n.shape!==undefined){e=n.shape}if(n.material!==undefined){d=n.material}var f=this.scene.world_scale;var i=this.scale_x;var h=this.scale_y;if(e.type===b5.Shape.TypeBox){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape;b.shape.SetAsBox(e.width/(2*f)*i,e.height/(2*f)*h)}else{if(e.type===b5.Shape.TypeCircle){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2CircleShape(e.width/f*i)}else{if(e.type===b5.Shape.TypePolygon){if(e.convexVertices!==undefined&&e.convexVertices.length>0){var a=[];var g=e.convexVertices.length;for(var m=0;m<g;m++){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape();var k=e.convexVertices[m];var j=[];var c=k.length;for(var l=0;l<c;l+=2){j.push({x:k[l]/f*i,y:k[l+1]/f*h})}b.shape.SetAsArray(j,j.length);if(d.density!==undefined){b.density=d.density}if(d.friction!==undefined){b.friction=d.friction}if(d.restitution!==undefined){b.restitution=d.restitution}if(n.is_sensor!==undefined){b.isSensor=n.is_sensor}if(n.collision_category!==undefined){b.filter.categoryBits=n.collision_category}if(n.collision_mask!==undefined){b.filter.maskBits=n.collision_mask}if(n.collision_group!==undefined){b.filter.groupIndex=n.collision_group}a.push(this.body.CreateFixture(b))}return a}else{b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape();var k=e.vertices;var j=[];var c=k.length;for(var l=0;l<c;l+=2){j.push({x:k[l]/f*i,y:k[l+1]/f*h})}b.shape.SetAsArray(j,j.length)}}}}if(d.density!==undefined){b.density=d.density}if(d.friction!==undefined){b.friction=d.friction}if(d.restitution!==undefined){b.restitution=d.restitution}if(d.is_sensor!==undefined){b.isSensor=d.is_sensor}if(n.collision_category!==undefined){b.filter.categoryBits=n.collision_category}if(n.collision_mask!==undefined){b.filter.maskBits=n.collision_mask}if(n.collision_group!==undefined){b.filter.groupIndex=n.collision_group}return this.body.CreateFixture(b)};b5.Actor.prototype.addJoint=function(o){if(this.body===null){return null}var l;var h=this.scene;var i=h.world;var j=h.world_scale;var k=Box2D.Common.Math.b2Vec2;var g=this.body;var f=o.actor_b.body;var e=g.GetWorldCenter();var a=f.GetWorldCenter();var c=new k(e.x,e.y);c.x+=o.anchor_a.x/j;c.y+=o.anchor_a.y/j;var b=new k(a.x,a.y);b.x+=o.anchor_b.x/j;b.y+=o.anchor_b.y/j;if(o.type==="weld"){l=new Box2D.Dynamics.Joints.b2WeldJointDef;l.Initialize(g,f,c);l.collideConnected=o.self_collide}else{if(o.type==="distance"){l=new Box2D.Dynamics.Joints.b2DistanceJointDef;l.Initialize(g,f,c,b);l.collideConnected=o.self_collide;l.frequencyHz=o.frequency;l.dampingRatio=o.damping}else{if(o.type==="revolute"){l=new Box2D.Dynamics.Joints.b2RevoluteJointDef;l.Initialize(g,f,c);l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerAngle=o.lower_limit*(Math.PI/180);l.upperAngle=o.upper_limit*(Math.PI/180)}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorTorque=o.max_motor_torque}}else{if(o.type==="prismatic"){l=new Box2D.Dynamics.Joints.b2PrismaticJointDef;l.Initialize(g,f,c,new k(o.axis.x,o.axis.y));l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerTranslation=o.lower_limit/j;l.upperTranslation=o.upper_limit/j}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorForce=o.max_motor_force}}else{if(o.type==="pulley"){var n=new k(e.x,e.y);n.x+=o.ground_a.x/j;n.y+=o.ground_a.y/j;var m=new k(a.x,a.y);m.x+=o.ground_b.x/j;m.y+=o.ground_b.y/j;l=new Box2D.Dynamics.Joints.b2PulleyJointDef;l.Initialize(g,f,n,m,c,b,o.ratio);l.collideConnected=o.self_collide}else{if(o.type==="wheel"){l=new Box2D.Dynamics.Joints.b2LineJointDef;l.Initialize(g,f,c,o.axis);l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerTranslation=o.lower_limit/j;l.upperTranslation=o.upper_limit/j}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorForce=o.max_motor_force}}else{if(o.type==="mouse"){l=new Box2D.Dynamics.Joints.b2MouseJointDef;l.collideConnected=o.self_collide;l.bodyA=g;l.bodyB=f;l.collideConnected=o.self_collide;l.maxForce=o.max_motor_force;l.dampingRatio=o.damping}}}}}}}var d=i.CreateJoint(l);this.joints.push(d);return d};b5.Actor.prototype.removeJoint=function(d){var a=this.joints;var c=a.length;for(var b=0;b<c;b++){if(a[b]===d){world.DestroyJoint(d);a.splice(b,1);return}}};b5.Actor.prototype.updateTransform=function(){var n=this.transform;if(this.transform_dirty){var g=this.scene;var c=this.rotation;var j=this.scale_x;var i=this.scale_y;var k=this.parent;if(k===null||this.orphaned){this.accum_scale_x=j;this.accum_scale_y=i}else{this.accum_scale_x=j*k.accum_scale_x;this.accum_scale_y=i*k.accum_scale_y}var l=Math.cos(c);var h=Math.sin(c);if(this.depth!==0&&this.depth!==1){var f=1/this.depth;j*=f;i*=f;n[4]=(this.x-g.camera_x)*f;n[5]=(this.y-g.camera_y)*f}else{this.transform_dirty=false;n[4]=this.x;n[5]=this.y}n[0]=l*j;n[1]=h*j;n[2]=-h*i;n[3]=l*i;var b=null;var a=this.atlas;if(a!==null){if(this.anim_frames!==null){b=a.getFrame(this.anim_frames[this.current_frame|0])}else{b=a.getFrame(this.current_frame|0)}}var e=this.ox;var d=this.oy;if(e!==0||d!==0||b!==null){if(!this.absolute_origin){e*=this.w;d*=this.h}n[4]-=e;n[5]-=d;if(b!==null){e-=b.ox;d-=b.oy}var m=[1,0,0,1,e,d];b5.Maths.preMulMatrix(n,m)}if(k!==null&&!this.orphaned){b5.Maths.mulMatrix(n,k.transform)}}};b5.Actor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var n=this.cache_canvas;var q=this.scene;var i=q.app;var d=i.canvas_scale;var p=i.display;this.preDraw();var h=null;if(n===null){var j=this.atlas;if(j!==null){if(this.anim_frames!==null){h=j.getFrame(this.anim_frames[this.current_frame|0])}else{h=j.getFrame(this.current_frame|0)}if(!this.ignore_atlas_size){this.w=h.w;this.h=h.h}if((this.prev_frame|0)!==(this.current_frame|0)){this.dirty()}this.prev_frame=this.current_frame}}var m=i.canvas_cx+q.x*d;var l=i.canvas_cy+q.y*d;if(this.ow===undefined){this.ow=this.w;this.oh=this.h}var c=this.ow/2;var b=this.oh/2;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){m-=q.camera_x*d;l-=q.camera_y*d}this.updateTransform();var o=this.self_clip;var a=this.clip_children;var e=this.transform;var s=e[4]*d+m;var r=e[5]*d+l;if(this.round_pixels){c=(c+0.5)|0;b=(b+0.5)|0;s=(s+0.5)|0;r=(r+0.5)|0}p.setTransform(e[0]*d,e[1]*d,e[2]*d,e[3]*d,s,r);if(o){this.setClipping(-c,-b)}if(n===null){if(j!==null){p.drawAtlasImage(j.bitmap.image,h.x,h.y,h.w,h.h,-c,-b,this.w+1,this.h+1)}else{if(this.bitmap!==null){p.drawImage(this.bitmap.image,-c,-b,this.w,this.h)}}}else{p.drawImage(n,-n.width>>1,-n.height>>1)}this.postDraw();if(a){if(!o){this.setClipping(-c,-b)}}else{if(o){p.restoreContext()}}var g=this.actors.length;if(g>0){var f=this.actors;for(var k=0;k<g;k++){f[k].draw()}}if(a){p.restoreContext()}};b5.Actor.prototype.drawToCache=function(){var e=b5.app.display;var d=null;var c=0;var b=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-this.w/2;b=this.y+d.height/2-this.h/2}}var g=null;var a=this.atlas;if(a!==null){if(this.anim_frames!==null){g=a.getFrame(this.anim_frames[this.current_frame<<0])}else{g=a.getFrame(this.current_frame<<0)}}if(d===null){d=e.createCache();d.width=this.w;d.height=this.h}e.setCache(d);if(a!==null){e.drawAtlasImage(a.bitmap.image,g.x,g.y,g.w,g.h,c,b,this.w,this.h)}else{if(this.bitmap!==null){e.drawImage(this.bitmap.image,c,b,this.w,this.h)}}e.setCache(null);this.cache_canvas=d};b5.Actor.prototype.preDraw=function(){var a=b5.app.display;if(this.parent===null||!this.use_parent_opacity){this.accum_opacity=this.opacity*this.scene.opacity}else{this.accum_opacity=this.parent.accum_opacity*this.opacity}a.setGlobalAlpha(this.accum_opacity);if(this.shadow){a.setShadow(this.shadow_x,this.shadow_y,this.shadow_colour,this.shadow_blur)}if(this.composite_op!==null){a.setGlobalCompositeOp(this.composite_op)}};b5.Actor.prototype.postDraw=function(){var a=b5.app.display;if(this.shadow){a.setShadowOff()}if(this.composite_op!==null){a.setGlobalCompositeOp("source-over")}};b5.Actor.prototype.baseUpdate=function(b){if(!this.active){return}if(this.onTick!==undefined){this.onTick(b)}this.timelines.update(b);this.actions.execute();this.tasks.execute();if(this.virtual){this.Virtual_update(b)}var d=this.scene;if(this.atlas!==null){this.current_frame+=this.frame_speed*b;var k;if(this.anim_frames!==null){k=this.anim_frames.length}else{k=this.atlas.getMaxFrames()}while(this.current_frame>=k){this.current_frame-=k}}var l=this.x;var i=this.y;var e=this.body;if(e!==null){var j=e.GetPosition();var g=d.world_scale;this.setRotation(e.GetAngle());this.setPosition(j.x*g,j.y*g)}else{this.rotation+=this.vr*b;this.vr*=this.vr_damping;this.x+=this.vx*b;this.vx*=this.vx_damping;this.y+=this.vy*b;this.vy*=this.vy_damping}if(this.vd!==0){this.depth+=this.vd*b;this.vd*=this.vd_damping}if(this.wrap_position){var c=d.extents[0];var n=(c+d.extents[2]);var h=d.extents[1];var a=(h+d.extents[3]);if(this.x<c){this.x=n}else{if(this.x>n){this.x=c}}if(this.y<h){this.y=a}else{if(this.y>a){this.y=h}}}if(this.parent===null||!this.parent.virtual){if(this.dock_x!==0){if(this.dock_x===b5.Actor.Dock_Left){this.x=-d.w/2+(this.w*this.scale_x)/2+this.margin[0]}else{if(this.dock_x===b5.Actor.Dock_Right){this.x=d.w/2-(this.w*this.scale_x)/2-this.margin[1]}}}if(this.dock_y!==0){if(this.dock_y===b5.Actor.Dock_Top){this.y=-d.h/2+(this.h*this.scale_y)/2+this.margin[2]}else{if(this.dock_y===b5.Actor.Dock_Bottom){this.y=d.h/2-(this.h*this.scale_y)/2-this.margin[3]}}}}if(this.x!==l||this.y!==i||(e===null&&this.vr!==0)){this.dirty()}var f=this.actors.length;if(f>0){var m=this.actors;for(var o=0;o<f;o++){m[o].update(b)}}this.cleanupDestroyedActors();if(this.order_changed){this.order_changed=false;b5.Utils.sortLayers(this.actors)}this.frame_count++};b5.Actor.prototype.update=function(a){this.baseUpdate(a)};b5.Actor.prototype.updateToPhysics=function(){if(this.body===null){return}var a=Box2D.Common.Math.b2Vec2;this.body.SetLinearVelocity(new a(this.vx,this.vy));this.body.SetAngularVelocity(this.vr);this.body.SetAwake(true)};b5.Actor.prototype.dirty=function(){this.transform_dirty=true;var b=this.actors;var d=b.length;for(var c=0;c<d;c++){b[c].dirty()}};b5.Actor.prototype.makeVirtual=function(){this.prev_scroll_pos_x=0;this.prev_scroll_pos_y=0;this.scroll_pos_x=0;this.scroll_pos_y=0;this.scroll_vx=0;this.scroll_vy=0;this.scroll_range=[0,0,0,0];this.virtual=true};b5.Actor.prototype.Virtual_onMoveTouch=function(a){if(this.touching&&(this.scroll_range[2]!==0||this.scroll_range[3]!==0)){var b=this.scene.app;this.prev_scroll_pos_x=this.scroll_pos_x;this.prev_scroll_pos_y=this.scroll_pos_y;this.scroll_vx=b.touch_drag_x;this.scroll_pos_x+=b.touch_drag_x;this.scroll_vy=b.touch_drag_y;this.scroll_pos_y+=b.touch_drag_y;if(this.scroll_vx!==0||this.scroll_vy!==0){this.Virtual_scrollRangeCheck();this.Virtual_updateLayout()}}};b5.Actor.prototype.Virtual_update=function(a){var b=false;if(!this.touching){this.prev_scroll_pos_x=this.scroll_pos_x;this.prev_scroll_pos_y=this.scroll_pos_y;this.scroll_pos_x+=this.scroll_vx;this.scroll_pos_y+=this.scroll_vy;if(this.scroll_vx!==0||this.scroll_vy!==0){this.Virtual_scrollRangeCheck();this.Virtual_updateLayout()}this.scroll_vx*=0.9;this.scroll_vy*=0.9;if(this.scroll_vx>-0.5&&this.scroll_vx<0.5){this.scroll_vx=0}if(this.scroll_vy>-0.5&&this.scroll_vy<0.5){this.scroll_vy=0}}if(this.frame_count===0){this.Virtual_updateLayout()}};b5.Actor.prototype.Virtual_scrollRangeCheck=function(){var a=this.scroll_pos_x;var f=this.scroll_pos_y;var e=-this.scroll_range[0];var c=e-this.scroll_range[2];var d=-this.scroll_range[1];var b=d-this.scroll_range[3];if(a<c){a=c;this.scroll_vx=0}else{if(a>e){a=e;this.scroll_vx=0}}if(f<b){f=b;this.scroll_vy=0}else{if(f>d){f=d;this.scroll_vy=0}}this.scroll_pos_x=a;this.scroll_pos_y=f};b5.Actor.prototype.Virtual_updateLayout=function(a){var j=this.prev_scroll_pos_x-this.scroll_pos_x;var i=this.prev_scroll_pos_y-this.scroll_pos_y;var c=this.actors.length;var e=this.w*this.scale_x/2;var b=this.h*this.scale_y/2;if(c>0){var d;var f=this.actors;for(var g=0;g<c;g++){d=f[g];if(d.dock_x!==0){if(d.dock_x===b5.Actor.Dock_Left){d.x=-e+d.w*d.scale_x/2+d.margin[0]}else{if(d.dock_x===b5.Actor.Dock_Right){d.x=e-d.w*d.scale_x/2-d.margin[1]}}}else{d.x+=j}if(d.dock_y!==0){if(d.dock_y===b5.Actor.Dock_Top){d.y=-b+d.h*d.scale_y/2+d.margin[2]}else{if(d.dock_y===b5.Actor.Dock_Bottom){d.y=b-d.h*d.scale_y/2-d.margin[3]}}}else{d.y+=i}d.dirty()}}};b5.Actor.prototype.hitTest=function(g){if(!this.touchable){return null}var h=this.actors.length;var i;if(h>0){var o=this.actors;for(var p=0;p<h;p++){i=o[p].hitTest(g);if(i!==null){return i}}}var f=this.scene;var q=this.transform;var c=q[4]+f.x;var b=q[5]+f.y;if(!this.ignore_camera){c-=f.camera_x;b-=f.camera_y}var m=this.accum_scale_x;var k=this.accum_scale_y;var n=(g.x-c)/m;var l=(g.y-b)/k;var e=n*q[0]+l*q[1];var d=n*q[2]+l*q[3];var j=(this.w*m)/2;var a=(this.h*k)/2;if(e>=-j&&e<=j&&d>=-a&&d<=a){return this}return null};b5.Actor.prototype.transformPoint=function(a,b){return b5.Maths.vecMulMatrix(a,b,this.transform)};b5.Actor.prototype.setClipping=function(a,f){var c=b5.app.display;c.saveContext();var e=this.clip_margin;var b=this.clip_shape;if(b===null){var d=this.type;if(d===b5.Actor.Type_Arc){c.clipArc(0,0,this.radius,0,2*Math.PI)}else{if(d===b5.Actor.Type_Polygon){c.clipPolygon(this.points)}else{c.clipRect(a+e[0],f+e[1],this.w-e[2]-e[0],this.h-e[3]-e[1])}}}else{var d=b.type;if(d===b5.Shape.TypeBox){c.clipRect(a+e[0],f+e[1],b.width-e[2]-e[0],b.height-e[3]-e[1])}else{if(d===b5.Shape.TypeCircle){c.clipArc(0,0,b.width,0,2*Math.PI)}else{if(d===b5.Shape.TypePolygon){c.clipPolygon(b.vertices)}}}}};b5.Actor.prototype.overlaps=function(e){var d=this.w;var g=this.h;var c=e.w;var f=e.h;var b=this.x-d/2;var i=this.y-g/2;var a=e.x-c/2;var h=e.y-f/2;return !((i+g<h)||(i>h+f)||(b>a+c)||(b+d<a))};"use strict";b5.ArcActor=function(){this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.radius=1;this.start_angle=0;this.end_angle=2*Math.PI;this.filled=true;b5.Actor.call(this);this.type=b5.Actor.Type_Arc};b5.ArcActor.prototype=new b5.Actor();b5.ArcActor.prototype.constructor=b5.ArcActor;b5.ArcActor.prototype.parent=b5.Actor.prototype;b5.ArcActor.prototype.update=function(a){return this.baseUpdate(a)};b5.ArcActor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var f=this.scene;var c=f.app;var o=c.canvas_scale;var l=c.display;if(a===null){if(this.filled&&this.fill_style!==""){l.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){l.setStrokeStyle(this.stroke_style)}if(!this.filled){l.setLineWidth(this.stroke_thickness)}}this.preDraw();var k=c.canvas_cx+f.x*o;var i=c.canvas_cy+f.y*o;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){k-=f.camera_x*o;i-=f.camera_y*o}this.updateTransform();var h=this.self_clip;var b=this.clip_children;var n=this.transform;var e=n[4]*o+k;var d=n[5]*o+i;if(this.round_pixels){e=(e+0.5)|0;d=(d+0.5)|0}l.setTransform(n[0]*o,n[1]*o,n[2]*o,n[3]*o,e,d);if(h){this.setClipping(0,0)}if(a===null){l.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled)}else{l.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw();if(b){if(!h){this.setClipping(0,0)}}else{if(h){l.restoreContext()}}var g=this.actors.length;if(g>0){var j=this.actors;for(var m=0;m<g;m++){j[m].draw()}}if(b){l.restoreContext()}};b5.ArcActor.prototype.drawToCache=function(){var e=b5.app.display;var d=null;var b=this.w;var g=this.h;var c=0;var a=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-b/2;a=this.y+d.height/2-g/2}}if(d===null){d=e.createCache();if(!this.filled&&this.stroke_style!==""){b+=this.stroke_thickness;g+=this.stroke_thickness;c=(this.stroke_thickness/2+0.5)<<0;a=(this.stroke_thickness/2+0.5)<<0}d.width=b;d.height=g}e.setCache(d);if(this.filled&&this.fill_style!==""){e.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){e.setStrokeStyle(this.stroke_style)}if(!this.filled){e.setLineWidth(this.stroke_thickness)}e.setTransform(1,0,0,1,c+this.w/2,a+this.h/2);e.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled);e.setCache(null);this.cache_canvas=d};b5.ArcActor.prototype.hitTest=function(h){if(!this.touchable){return null}var i=this.actors.length;var j;if(i>0){var p=this.actors;for(var q=0;q<i;q++){j=p[q].hitTest(h);if(j!==null){return j}}}var g=this.scene;var s=this.transform;var c=s[4]+g.x;var b=s[5]+g.y;if(!this.ignore_camera){c-=g.camera_x;b-=g.camera_y}var n=this.accum_scale_x;var l=this.accum_scale_y;var o=(h.x-c)/n;var m=(h.y-b)/l;var f=o*s[0]+m*s[1];var e=o*s[2]+m*s[3];var a=this.radius*n;a*=a;var k=f*f+e*e;if(k<=a){return this}return null};"use strict";b5.LabelActor=function(){this.text="";this.font="16pt Calibri";this.text_align="center";this.text_baseline="middle";this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.filled=true;b5.Actor.call(this);this.type=b5.Actor.Type_Label};b5.LabelActor.prototype=new b5.Actor();b5.LabelActor.prototype.constructor=b5.LabelActor;b5.LabelActor.prototype.parent=b5.Actor.prototype;b5.LabelActor.prototype.update=function(a){return this.baseUpdate(a)};b5.LabelActor.prototype.draw=function(){if(!this.visible||this.text===""){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var e=this.scene;var b=e.app;var l=b.canvas_scale;var j=b.display;if(a===null){if(this.font!==""){j.setFont(this.font)}if(this.textAlign!==""){j.setTextAlign(this.text_align)}if(this.textBaseline!==""){j.setTextBaseline(this.text_baseline)}if(this.filled&&this.fill_style!==""){j.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){j.setStrokeStyle(this.stroke_style)}if(!this.filled){j.setLineWidth(this.stroke_thickness)}}this.preDraw();var i=b.canvas_cx+e.x*l;var g=b.canvas_cy+e.y*l;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){i-=e.camera_x*l;g-=e.camera_y*l}this.updateTransform();var m=this.transform;var d=m[4]*l+i;var c=m[5]*l+g;if(this.round_pixels){d=(d+0.5)|0;c=(c+0.5)|0}j.setTransform(m[0]*l,m[1]*l,m[2]*l,m[3]*l,d,c);if(a===null){j.drawText(this.text,0,0,this.filled)}else{j.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw();var f=this.actors.length;if(f>0){var h=this.actors;for(var k=0;k<f;k++){h[k].draw()}}};b5.LabelActor.prototype.drawToCache=function(){var e=b5.app.display;var d=null;var b=this.w;var g=this.h;var c=0;var a=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-b/2;a=this.y+d.height/2-g/2}}if(d===null){d=e.createCache();d.width=b;d.height=g}e.setCache(d);if(this.font!==""){e.setFont(this.font)}if(this.textAlign!==""){e.setTextAlign(this.text_align)}if(this.textBaseline!==""){e.setTextBaseline(this.text_baseline)}if(this.filled&&this.fill_style!==""){e.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){e.setStrokeStyle(this.stroke_style)}if(!this.filled){e.setLineWidth(this.stroke_thickness)}e.setTransform(1,0,0,1,0,0);e.drawText(this.text,c+b/2,a+g/2,this.filled);e.setCache(null);this.cache_canvas=d};"use strict";b5.ParticleActor=function(){b5.Actor.call(this);this.type=b5.Actor.Type_Particle;this.gravity=0};b5.ParticleActor.prototype=new b5.Actor();b5.ParticleActor.prototype.constructor=b5.ParticleActor;b5.ParticleActor.prototype.parent=b5.Actor.prototype;b5.ParticleActor.prototype.resetParticle=function(b){b.life_time=0;if(b.orphaned){var a=this.transformPoint(b.org_x+this.x,b.org_y+this.y);b.x=a.x;b.y=a.y}else{b.x=b.org_x;b.y=b.org_y}b.rotation=b.org_rotation;b.scale_x=b.org_scale_x;b.scale_y=b.org_scale_y;b.depth=b.org_depth;b.opacity=b.org_opacity;b.current_frame=b.org_current_frame;b.vr=b.org_vr;b.vx=b.org_vx;b.vy=b.org_vy;b.vd=b.org_vd;b.vo=b.org_vo;b.vsx=b.org_vsx;b.vsy=b.org_vsy};b5.ParticleActor.prototype.addParticle=function(d,b,e,a){this.addActor(d);if(d.vo===undefined){d.vo=0}if(d.vsx===undefined){d.vsx=0}if(d.vsy===undefined){d.vsy=0}d.life_time=-a;d.life_span=b;d.num_lives=e;if(d.life_time<0){d.active=false;d.visible=false}d.org_num_lives=d.num_lives;d.org_x=d.x;d.org_y=d.y;d.org_rotation=d.rotation;d.org_scale_x=d.scale_x;d.org_scale_y=d.scale_y;d.org_depth=d.depth;d.org_opacity=d.opacity;d.org_current_frame=d.current_frame;d.org_vr=d.vr;d.org_vx=d.vx;d.org_vy=d.vy;d.org_vd=d.vd;d.org_vo=d.vo;d.org_vsx=d.vsx;d.org_vsy=d.vsy;if(d.orphaned){var c=this.transformPoint(d.org_x+this.x,d.org_y+this.y);d.x=c.x;d.y=c.y}return d};b5.ParticleActor.prototype.update=function(e){var d=this.actors;var c=d.length;if(c===0){if(this.onParticlesEnd!==undefined){this.onParticlesEnd()}this.destroy()}else{for(var b=c-1;b>=0;b--){var f=d[b];f.life_time+=e;var a=f.life_time;if(a>=0){if(a-e<0&&a>=0){f.active=true;f.visible=true}if(f.active){f.scale_x+=f.vsx*e;f.scale_y+=f.vsy*e;f.opacity+=f.vo*e;if(f.opacity<0){f.opacity=0}f.vy+=this.gravity*e;f.update(e);if(a>=f.life_span){if(f.num_lives>0){f.num_lives--}if(f.num_lives>0||f.org_num_lives===0){this.resetParticle(f)}else{if(this.onParticleLost!==undefined){if(this.onParticleLost(f)){f.destroy()}}else{f.destroy()}}}}}}}return this.baseUpdate(e)};b5.ParticleActor.prototype.generateExplosion=function(f,i,d,c,k,g,e,h){this.updateParentTransforms();for(var j=0;j<f;j++){var b;if(typeof i==="string"){b=new b5[i]()}else{b=new i()}for(var a in h){b[a]=h[a]}b.vr+=Math.random()*k;b.vx+=Math.random()*c-c/2;b.vy+=Math.random()*c-c/2;b.vx_damping=e;b.vy_damping=e;b.vo=-1/d;this.addParticle(b,d,1,j/(f*g))}};b5.ParticleActor.prototype.generatePlume=function(f,i,d,c,k,g,e,h){this.updateParentTransforms();for(var j=0;j<f;j++){var b;if(typeof i==="string"){b=new b5[i]()}else{b=new i()}for(var a in h){b[a]=h[a]}b.vr+=Math.random()*k;b.vx+=Math.random()*c-c/2;b.vy+=Math.random()*-c-c/2;b.vx_damping=e;b.vy_damping=e;b.vo=-1/d;this.addParticle(b,d,0,j/(f*g))}};b5.ParticleActor.prototype.generateRain=function(g,j,e,d,l,h,f,c,i){this.updateParentTransforms();for(var k=0;k<g;k++){var b;if(typeof j==="string"){b=new b5[j]()}else{b=new j()}for(var a in i){b[a]=i[a]}b.x=Math.random()*c-c/2;b.vr+=Math.random()*l;b.vy+=Math.random()*d+d/2;b.vx_damping=f;b.vy_damping=f;b.vo=-1/e;this.addParticle(b,e,0,k/(g*h))}};"use strict";b5.PolygonActor=function(){this.fill_style="#ffffff";this.stroke_style="";this.stroke_thickness=1;this.filled=true;this.points=null;b5.Actor.call(this);this.type=b5.Actor.Type_Polygon};b5.PolygonActor.prototype=new b5.Actor();b5.PolygonActor.prototype.constructor=b5.PolygonActor;b5.PolygonActor.prototype.parent=b5.Actor.prototype;b5.PolygonActor.prototype.update=function(a){return this.baseUpdate(a)};b5.PolygonActor.prototype.draw=function(){if(!this.visible||this.points===null){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var f=this.scene;var c=f.app;var l=c.display;if(a===null){if(this.filled&&this.fill_style!==""){l.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){l.setStrokeStyle(this.stroke_style)}if(!this.filled){l.setLineWidth(this.stroke_thickness)}}this.preDraw();var o=c.canvas_scale;var k=c.canvas_cx+this.scene.x*o;var i=c.canvas_cy+this.scene.y*o;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){k-=f.camera_x*o;i-=f.camera_y*o}this.updateTransform();var h=this.self_clip;var b=this.clip_children;var n=this.transform;var e=n[4]*o+k;var d=n[5]*o+i;if(this.round_pixels){e=(e+0.5)|0;d=(d+0.5)|0}l.setTransform(n[0]*o,n[1]*o,n[2]*o,n[3]*o,e,d);if(h){this.setClipping(0,0)}if(a===null){l.drawPolygon(0,0,this.points,this.filled)}else{l.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw();if(b){if(!h){this.setClipping(0,0)}}else{if(h){l.restoreContext()}}var g=this.actors.length;if(g>0){var j=this.actors;for(var m=0;m<g;m++){j[m].draw()}}if(b){l.restoreContext()}};b5.PolygonActor.prototype.drawToCache=function(){var e=b5.app.display;var d=null;var b=this.w;var g=this.h;var c=0;var a=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-b/2;a=this.y+d.height/2-g/2}}if(d===null){d=e.createCache();if(!this.filled&&this.stroke_style!==""){b+=this.stroke_thickness;g+=this.stroke_thickness}d.width=b;d.height=g}e.setCache(d);if(this.filled&&this.fill_style!==""){e.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){e.setStrokeStyle(this.stroke_style)}if(!this.filled){e.setLineWidth(this.stroke_thickness)}e.setTransform(1,0,0,1,c+this.w/2,a+this.h/2);e.drawPolygon(0,0,this.points,this.filled);e.setCache(null);this.cache_canvas=d};"use strict";b5.RectActor=function(){this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.corner_radius=0;this.filled=true;b5.Actor.call(this);this.type=b5.Actor.Type_Rect};b5.RectActor.prototype=new b5.Actor();b5.RectActor.prototype.constructor=b5.RectActor;b5.RectActor.prototype.parent=b5.Actor.prototype;b5.RectActor.prototype.update=function(a){return this.baseUpdate(a)};b5.RectActor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var h=this.scene;var c=h.app;var q=c.canvas_scale;var n=c.display;if(a===null){if(this.filled&&this.fill_style!==""){n.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){n.setStrokeStyle(this.stroke_style)}if(!this.filled){n.setLineWidth(this.stroke_thickness)}}this.preDraw();var m=c.canvas_cx+h.x*q;var k=c.canvas_cy+h.y*q;var e=this.w/2;var d=this.h/2;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){m-=h.camera_x*q;k-=h.camera_y*q}this.updateTransform();var j=this.self_clip;var b=this.clip_children;var p=this.transform;var g=p[4]*q+m;var f=p[5]*q+k;if(this.round_pixels){e=(e+0.5)|0;d=(d+0.5)|0;g=(g+0.5)|0;f=(f+0.5)|0}n.setTransform(p[0]*q,p[1]*q,p[2]*q,p[3]*q,g,f);if(j){this.setClipping(-e,-d)}if(a===null){if(this.corner_radius!==0){n.drawRoundRect(-e,-d,this.w,this.h,this.corner_radius,this.filled)}else{n.drawRect(-e,-d,this.w,this.h,this.filled)}}else{n.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw();if(b){if(!j){this.setClipping(-e,-d)}}else{if(j){n.restoreContext()}}var i=this.actors.length;if(i>0){var l=this.actors;for(var o=0;o<i;o++){l[o].draw()}}if(b){n.restoreContext()}};b5.RectActor.prototype.drawToCache=function(){var e=b5.app.display;var d=null;var b=this.w;var g=this.h;var c=0;var a=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-b/2;a=this.y+d.height/2-g/2}}if(d===null){d=e.createCache();if(!this.filled&&this.stroke_style!==""){b+=this.stroke_thickness;g+=this.stroke_thickness;c=this.stroke_thickness>>1;a=this.stroke_thickness>>1}d.width=b;d.height=g}e.setCache(d);if(this.filled&&this.fill_style!==""){e.setFillStyle(this.fill_style)}if(!this.filled&&this.stroke_style!==""){e.setStrokeStyle(this.stroke_style)}if(!this.filled){e.setLineWidth(this.stroke_thickness)}e.setTransform(1,0,0,1,b/2+c,g/2+a);if(this.corner_radius!==0){e.drawRoundRect(-b/2,-g/2,this.w,this.h,this.corner_radius,this.filled)}else{e.drawRect(-b/2,-g/2,this.w,this.h,this.filled)}e.setCache(null);this.cache_canvas=d};"use strict";b5.MapActor=function(){this.tiles=[];this.map=[];this.collision_map=[];this.tile_width=32;this.tile_height=32;this.map_width=0;this.map_height=0;this.display_width=8;this.display_height=8;b5.Actor.call(this);this.type=b5.Actor.Type_Map};b5.MapActor.prototype=new b5.Actor();b5.MapActor.prototype.constructor=b5.MapActor;b5.MapActor.prototype.parent=b5.Actor.prototype;b5.MapActor.prototype.update=function(a){return this.baseUpdate(a)};b5.MapActor.prototype.generateTiles=function(f,a,e,g){var d=0.5;var b=0.5;for(var c=0;c<f;c++){this.tiles[c]={x:d,y:b};d+=a;if(d>=g){d=0.5;b+=e}}this.tile_width=a;this.tile_height=e};b5.MapActor.prototype.setTile=function(a,f,c,e){var b=this.map_width;var d=this.map_height;if(a<0||a>=b){return}if(f<0||f>=d){return}if(e!==undefined&&e){this.collision_map[f*b+a]=c}else{this.map[f*b+a]=c}};b5.MapActor.prototype.getTile=function(a,e,d){var b=this.map_width;var c=this.map_height;if(a<0||a>=b){return -1}if(e<0||e>=c){return -1}if(d!==undefined&&d){return this.collision_map[e*b+a]}return this.map[e*b+a]};b5.MapActor.prototype.getTileXY=function(a,f){var c=this.map_width;var e=this.map_height;var d=this.tile_width;var b=this.tile_height;return{x:Math.round((a-d/2)/d)+(c>>1),y:Math.round((f-b/2)/b)+(e>>1)}};b5.MapActor.prototype.getTilePosition=function(b,f,a){var e=this.tile_width;var c=this.tile_height;var d=this.getTileXY(b,f);d.x-=this.map_width>>1;d.y-=this.map_height>>1;d.x*=e;d.y*=c;if(a==="m"){d.y+=c/2}else{if(a==="b"){d.y+=c}else{if(a==="c"){d.x+=e/2}else{if(a==="r"){d.x+=e}}}}return d};b5.MapActor.prototype.getTileFromPosition=function(a,d,c){var b=this.getTileXY(a,d);return this.getTile(b.x,b.y,c)};b5.MapActor.prototype.draw=function(){if(!this.visible){return}var w=this.scene;var g=w.app;var b=g.canvas_scale;var s=g.display;this.preDraw();var o=g.canvas_cx+w.x*b;var n=g.canvas_cy+w.y*b;if(!this.ignore_camera&&(this.depth===0||this.depth===1)){o-=w.camera_x*b;n-=w.camera_y*b}this.updateTransform();var c=this.transform;var C=c[4]*b+o;var A=c[5]*b+n;if(this.round_pixels){C=(C+0.5)|0;A=(A+0.5)|0}s.setTransform(c[0]*b,c[1]*b,c[2]*b,c[3]*b,C,A);var i,h,e,F;var l=this.map_width;var v=this.map_height;var u=this.tile_width;var a=this.tile_height;var B=this.map;var z=this.tiles;var E;if(this.bitmap!==null){E=this.bitmap}else{if(this.atlas!==null){E=this.atlas.bitmap}}var r=E.image;var k=this.display_width;var j=this.display_height;if(k!==l){o=((((w.camera_x-this.x)/u)-(k>>1))+0.5)|0}else{o=-k>>1}var D=o;if(j!==v){n=((((w.camera_y-this.y)/a)-(j>>1))+0.5)|0}else{n=-j>>1}var q=o*u;var G=q;var p=n*a;o+=l>>1;D=o;n+=v>>1;for(h=0;h<j;h++){if(n>=0&&n<v){o=D;q=G;for(i=0;i<k;i++){if(o>=0){e=B[n*l+o];F=z[e];s.drawAtlasImage(r,F.x,F.y,u-1,a-1,q,p,u+1,a+1)}q+=u;o++;if(o>=l){break}}}p+=a;n++;if(n>=v){break}}this.postDraw();var f=this.actors.length;if(f>0){var d=this.actors;for(var m=0;m<f;m++){d[m].draw()}}};"use strict";b5.App=function(a,b){b5.app=this;this.removals=[];this.touched=false;this.touch_pos={x:0,y:0};this.touch_drag_x=0;this.touch_drag_y=0;this.timer=null;this.last_time=Date.now();this.dt=0;this.avg_time=0;this.avg_fps=60;this.avg_frame=0;this.canvas_scale=1;this.pixel_ratio=1;this.canvas_width=a.width;this.canvas_height=a.height;this.display_width=a.width;this.display_height=a.height;this.canvas_cx=this.canvas_width>>1;this.canvas_cy=this.canvas_height>>1;this.order_changed=true;this.total_loaded=0;this.total_load_errors=0;this.inner_width=b5.Display.getWidth();this.inner_height=b5.Display.getHeight();this.scenes=[];this.canvas=a;this.canvas_scale_method=b5.App.FitNone;this.touch_supported=this.isTouchSupported();this.allow_touchables=true;this.target_frame_rate=60;this.adaptive_physics=false;this.focus_scene=null;this.focus_scene2=null;this.clear_canvas=false;this.touch_focus=null;this.debug=false;this.timelines=new b5.TimelineManager();this.actions=new b5.ActionsListManager();this.events=new b5.EventsManager();this.tasks=new b5.TasksManager();this.box2d=typeof Box2D!="undefined";this.loading_screen={background_fill:"#fffff",background_image:"loading.png",bar_background_fill:"#8080ff",bar_fill:"#ffffff"};this.use_web_audio=b;this.bitmaps=[];this.brushes=[];this.shapes=[];this.materials=[];this.sounds=[];this.onResourceLoaded=function(d,c){this.onResourceLoadedBase(d,c)};this.display=new b5.Display(this.canvas);this.use_web_audio=b5.Sound.init(this);if(window.navigator.msPointerEnabled){a.addEventListener("MSPointerDown",this.onTouchStart,false);a.addEventListener("MSPointerMove",this.onTouchMove,false);a.addEventListener("MSPointerUp",this.onTouchEnd,false)}else{if(this.touch_supported){a.addEventListener("touchstart",this.onTouchStart,false);a.addEventListener("touchmove",this.onTouchMove,false);a.addEventListener("touchend",this.onTouchEnd,false)}else{a.addEventListener("mousedown",this.onTouchStart,false);a.addEventListener("mousemove",this.onTouchMove,false);a.addEventListener("mouseup",this.onTouchEnd,false);a.addEventListener("mouseout",this.onTouchEnd,false)}}window.addEventListener("keypress",this.onKeyPress,false);window.addEventListener("keydown",this.onKeyDown,false);window.addEventListener("keyup",this.onKeyUp,false)};Object.defineProperty(b5.App.prototype,"_focus_scene",{get:function(){return this.focus_scene},set:function(a){if(this.focus_scene!==a){this.focus_scene=b5.Utils.resolveObject(a)}}});Object.defineProperty(b5.App.prototype,"_focus_scene2",{get:function(){return this.focus_scene2},set:function(a){if(this.focus_scene2!==a){this.focus_scene2=b5.Utils.resolveObject(a)}}});b5.App.FitNone=0;b5.App.FitX=1;b5.App.FitY=2;b5.App.FitBest=3;b5.App.FitSize=4;b5.App.FitGreatest=5;b5.App.FitSmallest=6;b5.App.prototype.onKeyPress=function(a){var b=b5.app;if(b.focus_scene!=null){b.focus_scene.onKeyPressBase(a)}};b5.App.prototype.onKeyDown=function(a){var b=b5.app;if(b.focus_scene!=null){b.focus_scene.onKeyDownBase(a)}};b5.App.prototype.onKeyUp=function(a){var b=b5.app;if(b.focus_scene!=null){b.focus_scene.onKeyUpBase(a)}};b5.App.prototype.isTouchSupported=function(){var b=window.navigator.msMaxTouchPoints;var a="ontouchstart" in this.canvas;if(b||a){return true}return false};b5.App.prototype.onTouchStart=function(f){var g=b5.app;if(g.touch_supported){f.stopPropagation();f.preventDefault()}var b=g.focus_scene;var a=g.focus_scene2;var d=g.display;g.touched=true;if(g.touch_supported&&f.changedTouches!==undefined){g.touch_pos=d.getCanvasPoint(f.changedTouches[0].pageX,f.changedTouches[0].pageY)}else{g.touch_pos=d.getCanvasPoint(f.pageX,f.pageY)}if(b!=null){b.onBeginTouchBase(g.touch_pos)}if(a!=null){a.onBeginTouchBase(g.touch_pos)}if(g.allow_touchables){var c=g.findHitActor(g.touch_pos);if(c!=null){g.touch_focus=c;c.onBeginTouchBase(g.touch_pos)}}};b5.App.prototype.onTouchEnd=function(f){var g=b5.app;if(g.touch_supported){f.stopPropagation();f.preventDefault()}var b=g.focus_scene;var a=g.focus_scene2;var d=g.display;g.touched=false;if(g.touch_supported&&f.changedTouches!==undefined){g.touch_pos=d.getCanvasPoint(f.changedTouches[0].pageX,f.changedTouches[0].pageY)}else{g.touch_pos=d.getCanvasPoint(f.pageX,f.pageY)}if(b!=null){b.onEndTouchBase(g.touch_pos)}if(a!=null){a.onEndTouchBase(g.touch_pos)}if(g.allow_touchables){var c=g.findHitActor(g.touch_pos);if(c!=null){c.onEndTouchBase(g.touch_pos)}if(g.touch_focus!=null){if(g.touch_focus.onLostTouchFocus!==undefined){g.touch_focus.onLostTouchFocus(g.touch_pos)}g.touch_focus=null}}};b5.App.prototype.onTouchMove=function(g){var h=b5.app;if(h.touch_supported){g.stopPropagation();g.preventDefault()}var c=h.focus_scene;var b=h.focus_scene2;var a=h.touch_pos.x;var i=h.touch_pos.y;var f=h.display;if(h.touch_supported&&g.changedTouches!==undefined){h.touch_pos=f.getCanvasPoint(g.changedTouches[0].pageX,g.changedTouches[0].pageY)}else{h.touch_pos=f.getCanvasPoint(g.pageX,g.pageY)}h.touch_drag_x=a-h.touch_pos.x;h.touch_drag_y=i-h.touch_pos.y;if(c!=null){c.onMoveTouchBase(h.touch_pos)}if(b!=null){b.onMoveTouchBase(h.touch_pos)}if(h.allow_touchables){var d=h.findHitActor(h.touch_pos);if(d!=null){d.onMoveTouchBase(h.touch_pos)}}};b5.App.prototype.addScene=function(a){this.scenes.push(a);a.app=this;return a};b5.App.prototype.removeScene=function(a){if(this.focus_scene==a){this.focus_scene=null}this.removals.push(a)};b5.App.prototype.cleanupDestroyedScenes=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.scenes;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g==a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};b5.App.prototype.findScene=function(b){var a=this.scenes;var d=a.length;for(var c=0;c<d;c++){if(a[c].name==b){return a[c]}}return null};b5.App.prototype.addResource=function(c,b){var a=b5.Utils.getResFromType(this,b);if(a!=null){a.push(c);c.parent=this}};b5.App.prototype.removeResource=function(e,c){var b=b5.Utils.getResFromType(this,c);if(b!=null){var d=b.length;for(var a=0;a<d;a++){if(b[a]==e){b.parent=null;b.splice(a,1);return}}}};b5.App.prototype.findResource=function(a,d){var c=b5.Utils.getResFromType(this,d);if(c==null){return null}var e=c.length;for(var b=0;b<e;b++){if(c[b].name===a){return c[b]}}if(this.debug){console.log("resource '"+a+"' ("+d+") not found")}return null};b5.App.prototype.countResourcesNeedLoading=function(f){var e=0;var c=this.bitmaps;var d=c.length;for(var b=0;b<d;b++){if(c[b].preload){e++}}c=this.sounds;d=c.length;for(b=0;b<d;b++){if(c[b].preload){e++}}if(f){var a=this.scenes;d=a.length;for(b=0;b<d;b++){e+=a[b].countResourcesNeedLoading()}}return e};b5.App.prototype.onResourceLoadedBase=function(b,a){if(b.preload){b5.app.total_loaded++}if(a){if(b.preload){b5.app.total_load_errors++}console.log("Error loading resource "+b.name)}else{if(this.debug){console.log("Resource loaded "+b.name)}}b.loaded=true};b5.App.prototype.waitForResources=function(){var g=this;if(g.loading_screen!==null){var b=g.display;var h=g.canvas_scale;var d=400;var f=80;b.setTransform(1,0,0,1,0,0);b.setFillStyle(g.loading_screen.background_fill);b.drawRect(0,0,g.display_width,g.display_height);var c=new Image();c.src=g.loading_screen.background_image;c.onload=function(){b.setTransform(h,0,0,h,g.canvas_cx,g.canvas_cy);b.drawImage(c,-c.width>>1,-c.height>>1,c.width,c.height);b.setFillStyle(g.loading_screen.bar_background_fill);b.drawRoundRect(-d>>1,(g.canvas_height>>2)-(f>>1),d,f,20,true)}}var e=g.countResourcesNeedLoading(true);var a=setInterval(function(){var k=b5.app.total_loaded;if(k>=e){if(b5.app.debug){console.log("Total resources loaded "+k+" of "+e);console.log("Total resource load errors "+b5.app.total_load_errors)}clearInterval(a);var n=setInterval(function(){g.start();clearInterval(n)},1000)}if(g.loading_screen!==null){var j=d-20;var m=f-20;var l=k/e;if(l>1){l=1}var i=(j*l)<<0;b.setFillStyle(g.loading_screen.bar_fill);b.drawRoundRect(-j>>1,(g.canvas_height>>2)-(m>>1),i,m,10,true)}},100)};b5.App.prototype.draw=function(){var a=this.scenes;var c=a.length;for(var b=0;b<c;b++){a[b].draw()}};b5.App.prototype.update=function(d){var e=b5.app;var a=this.scenes;var c=a.length;e.dt=d;e.timelines.update(d);e.actions.execute();e.tasks.execute();for(var b=0;b<c;b++){a[b].update(d)}this.cleanupDestroyedScenes();if(this.order_changed){this.order_changed=false;b5.Utils.sortLayers(this.scenes)}};b5.App.prototype.mainLogic=function(){var b=b5.app;var a=Date.now();var c=a-b.last_time;b.last_time=a;if(b.target_frame_rate===0){b.update(c/1000)}else{b.update(1/b.target_frame_rate)}b.avg_time+=c;b.avg_frame++;if(b.avg_frame==60){b.avg_frame=0;b.avg_fps=60000/b.avg_time;b.avg_time=0}};b5.App.prototype.mainDraw=function(){var a=b5.app;if(b5.Display.getWidth()!==a.inner_width||b5.Display.getHeight()!==a.inner_height){a.setCanvasScalingMethod()}if(a.clear_canvas){a.display.clear(true)}a.draw();requestAnimationFrame(a.mainDraw)};b5.App.prototype.start=function(){this.timer=setInterval(this.mainLogic,1000/this.target_frame_rate);this.mainDraw();this.dirty()};b5.App.prototype.findHitActor=function(a){var b=null;if(this.focus_scene!==null){b=this.focus_scene.findHitActor(a)}if(b===null&&this.focus_scene2!==null){b=this.focus_scene2.findHitActor(a)}return b};b5.App.prototype.dirty=function(){var b=this.scenes;var c=b.length;for(var a=0;a<c;a++){b[a].dirty()}};b5.App.prototype.setCanvasScalingMethod=function(a){if(a!==undefined){this.canvas_scale_method=a}var d=b5.Display.getWidth();var j=b5.Display.getHeight();this.inner_width=d;this.inner_height=j;var i=this.canvas_width;var e=this.canvas_height;var b=i;var f=e;var h=1;var g=1;this.canvas_scale=1;if(this.canvas_scale_method===b5.App.FitNone){}else{if(this.canvas_scale_method===b5.App.FitSize){b=d;f=j;this.canvas.width=b*this.pixel_ratio;this.canvas.height=f*this.pixel_ratio}else{b=d;f=j;h=b/i;g=f/e;var c=1;switch(this.canvas_scale_method){case b5.App.FitX:c=h;break;case b5.App.FitY:c=g;break;case b5.App.FitBest:c=h<g?h:g;break;case b5.App.FitGreatest:if(b>f){c=h}else{c=g}break;case b5.App.FitSmallest:if(b<f){c=h}else{c=g}break}this.canvas_scale=c;this.canvas.width=b*this.pixel_ratio;this.canvas.height=f*this.pixel_ratio}}this.canvas_cx=b>>1;this.canvas_cy=f>>1;this.display_width=b;this.display_height=f;this.dirty()};b5.App.prototype.parseAndSetFocus=function(a){new b5.Xoml(this).parseResources(this,[b5.data[a]]);this.order_changed=true;this.focus_scene=this.findScene(a)};"use strict";b5.Scene=function(){this.app=null;this.actors=[];this.removals=[];this.world=null;this.timelines=new b5.TimelineManager();this.actions=new b5.ActionsListManager();this.tasks=new b5.TasksManager();this.events=new b5.EventsManager();this.order_changed=true;this.name="";this.tag="";this.active=true;this.visible=true;this.layer=0;this.x=0;this.y=0;this.w=1024;this.h=768;this.clip_children=true;this.clip_shape=null;this.camera_x=0;this.camera_y=0;this.camera_vx=0;this.camera_vy=0;this.vx_damping=1;this.vy_damping=1;this.follow_speed_x=0.3;this.follow_speed_y=0.3;this.target_x=null;this.target_y=null;this.touch_pan_x=false;this.touch_pan_y=false;this.panning=false;this.min_panning=0;this.world_scale=20;this.time_step=0;this.extents=[0,0,0,0];this.opacity=1;this.frame_count=0;this.touching=false;this.touchmove=false;this.bitmaps=[];this.brushes=[];this.shapes=[];this.materials=[];this.sounds=[]};Object.defineProperty(b5.Scene.prototype,"_x",{get:function(){return this.x},set:function(a){if(this.x!==a){this.x=a}}});Object.defineProperty(b5.Scene.prototype,"_y",{get:function(){return this.y},set:function(a){if(this.y!==a){this.y=a}}});Object.defineProperty(b5.Scene.prototype,"_layer",{get:function(){return this.layer},set:function(a){if(this.layer!==a){this.layer=a;this.app.order_changed=true}}});Object.defineProperty(b5.Scene.prototype,"_clip_shape",{get:function(){return this.clip_shape},set:function(a){if(this.clip_shape!==a){this.clip_shape=b5.Utils.resolveResource(a,"shape")}}});b5.Scene.prototype.release=function(){if(this.onDestroy!==undefined){this.onDestroy()}this.world=null;this.actors=null};b5.Scene.prototype.destroy=function(){this.app.removeScene(this)};b5.Scene.prototype.addActor=function(a){this.actors.push(a);a.scene=this;return a};b5.Scene.prototype.removeActor=function(a){this.removals.push(a)};b5.Scene.prototype.removeActorsWithTag=function(a){var b=this.actors;var e=b.length;var d=this.removals;for(var c=0;c<e;c++){if(b[c].tag===a){d.push(b[c])}}};b5.Scene.prototype.cleanupDestroyedActors=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.actors;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g===a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};b5.Scene.prototype.findActor=function(d,c){if(c===undefined){c=false}var b=this.actors;var f=b.length;for(var e=0;e<f;e++){if(b[e].name===d){return b[e]}else{if(c){var a=b[e].findActor(d,c);if(a!==null){return a}}}}return null};b5.Scene.prototype.findActorById=function(f,c){if(c===undefined){c=false}var b=this.actors;var e=b.length;for(var d=0;d<e;d++){if(b[d].id===f){return b[d]}else{if(c){var a=b[d].findActorById(f,c);if(a!==null){return a}}}}return null};b5.Scene.prototype.bringToFront=function(){var a=this.app.scenes;var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]===this){c=b;break}}if(c>=0){a.splice(c,1);a.push(this)}};b5.Scene.prototype.sendToBack=function(){var a=this.app.scenes;var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]===this){c=b;break}}if(c>=0){a.splice(c,1);a.unshift(this)}};b5.Scene.prototype.onKeyPressBase=function(a){if(this.onKeyPress!==undefined){this.onKeyPress(a)}};b5.Scene.prototype.onKeyDownBase=function(a){if(this.onKeyDown!==undefined){this.onKeyDown(a)}};b5.Scene.prototype.onKeyUpBase=function(a){if(this.onKeyUp!==undefined){this.onKeyUp(a)}};b5.Scene.prototype.onBeginTouchBase=function(a){this.touching=true;if(this.onBeginTouch!==undefined){this.onBeginTouch(a)}};b5.Scene.prototype.onEndTouchBase=function(a){if(this.touching&&this.onTapped!==undefined){this.onTapped(a)}this.touching=false;this.touchmove=false;if(this.onEndTouch!==undefined){this.onEndTouch(a)}this.panning=false};b5.Scene.prototype.onMoveTouchBase=function(a){this.touchmove=true;if(this.onMoveTouch!==undefined){this.onMoveTouch(a)}if(this.touching){var c=this.app;var b=0;if(this.touch_pan_x){b=c.touch_drag_x;this.camera_vx=b*c.target_frame_rate;this.camera_x+=b}if(this.touch_pan_y){b=c.touch_drag_y;this.camera_vy=b*c.target_frame_rate;this.camera_y+=b}if((c.touch_drag_x*c.touch_drag_x+c.touch_drag_y*c.touch_drag_y)>this.min_panning){this.panning=true}}};b5.Scene.prototype.initWorld=function(a,d,b){if(!this.app.box2d){return}this.world=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(a,d),b);var c=new Box2D.Dynamics.b2ContactListener;c.BeginContact=function(e){var f=e.GetFixtureA().GetBody().GetUserData();if(f.onCollisionStart!==undefined){f.onCollisionStart(e)}f=e.GetFixtureB().GetBody().GetUserData();if(f.onCollisionStart!==undefined){f.onCollisionStart(e)}};c.EndContact=function(e){var f=e.GetFixtureA().GetBody().GetUserData();if(f.onCollisionEnd!==undefined){f.onCollisionEnd(e)}f=e.GetFixtureB().GetBody().GetUserData();if(f.onCollisionEnd!==undefined){f.onCollisionEnd(e)}};this.world.SetContactListener(c)};b5.Scene.prototype.draw=function(){if(!this.visible){return}var a=this.app;var i=a.canvas_scale;var f=a.display;if(this.clip_children){var e=a.canvas_cx+this.x;var d=a.canvas_cy+this.y;f.setTransform(i,0,0,i,e,d);f.saveContext();if(this.clip_shape===null){f.clipRect(-this.w/2,-this.h/2,this.w,this.h)}else{var c=this.clip_shape;if(this.clip_shape.type===b5.Shape.TypeBox){f.clipRect(0,0,c.width,c.height)}else{if(this.clip_shape.type===b5.Shape.TypeCircle){f.clipArc(0,0,c.width,0,2*Math.PI)}else{if(this.clip_shape.type===b5.Shape.TypePolygon){f.clipPolygon(c.vertices)}}}}}var g=this.actors;var b=g.length;for(var h=0;h<b;h++){g[h].draw()}if(this.clip_children){f.restoreContext()}};b5.Scene.prototype.baseUpdate=function(e){if(!this.active){return false}if(this.onTick!==undefined){this.onTick(e)}this.timelines.update(e);this.actions.execute();this.tasks.execute();this.updateCamera(e);var a=this.actors;var d=a.length;for(var c=0;c<d;c++){a[c].update(e)}if(this.world!==null){var f=b5.app;if(this.time_step===0){this.world.Step(e,10,10)}else{var b=1;if(f.adaptive_physics){b=(f.target_frame_rate/f.avg_fps+0.5)<<0;if(b<1){b=1}else{if(b>3){b=3}}}for(var c=0;c<b;c++){this.world.Step(this.time_step,10,10)}}}if(this.world!==null){this.world.ClearForces()}this.frame_count++;this.cleanupDestroyedActors();if(this.order_changed){this.order_changed=false;b5.Utils.sortLayers(this.actors)}return true};b5.Scene.prototype.update=function(a){return this.baseUpdate(a)};b5.Scene.prototype.updateCamera=function(b){if(this.target_x!==null){if(this.follow_speed_x===0){this.camera_x=this.target_x.x;this.camera_vx=0}else{this.camera_vx+=(this.target_x.x-this.camera_x)*this.follow_speed_x}}if(this.target_y!==null){if(this.follow_speed_y===0){this.camera_y=this.target_y.y;this.camera_vy=0}else{this.camera_vy+=(this.target_y.y-this.camera_y)*this.follow_speed_y}}if(!this.touching){this.camera_x+=this.camera_vx*b;this.camera_y+=this.camera_vy*b;this.camera_vx*=this.vx_damping;this.camera_vy*=this.vy_damping}if(this.camera_x!==0||this.camera_y!==0){var h=this.extents[2];var e=this.extents[3];var j=this.app.canvas_width;var g=this.app.canvas_height;if(h!==0&&j<=h){var f=j/2;var c=this.extents[0]+f;var k=(this.extents[0]+h)-f;if(this.camera_x<c){this.camera_x=c;this.camera_vx=0}if(this.camera_x>k){this.camera_x=k;this.camera_vx=0}}if(j>h){this.camera_x=0}if(e!==0&&g<=e){var d=g/2;var i=this.extents[1]+d;var a=(this.extents[1]+e)-d;if(this.camera_y<i){this.camera_y=i;this.camera_vy=0}if(this.camera_y>a){this.camera_y=a;this.camera_vy=0}}if(g>e){this.camera_y=0}}};b5.Scene.prototype.findHitActor=function(a){var b=this.actors;var d=b.length;var e=null;for(var c=d-1;c>=0;c--){e=b[c].hitTest(a);if(e!==null){return e}}return e};b5.Scene.prototype.dirty=function(){var b=this.actors;var d=b.length;for(var c=0;c<d;c++){b[c].dirty()}};b5.Scene.prototype.addResource=function(c,b){if(b===undefined){throw"Resource type not specified"}var a=b5.Utils.getResFromType(this,b);if(a!==null){a.push(c);c.parent=this}};b5.Scene.prototype.removeResource=function(e,c){var b=b5.Utils.getResFromType(this,c);if(b!==null){var d=b.length;for(var a=0;a<d;a++){if(b[a]===e){b.parent=null;b.splice(a,1);return}}}};b5.Scene.prototype.findResource=function(a,d){var c=b5.Utils.getResFromType(this,d);if(c===null){return null}var e=c.length;for(var b=0;b<e;b++){if(c[b].name===a){return c[b]}}return this.app.findResource(a,d)};b5.Scene.prototype.areResourcesLoaded=function(){var b=this.bitmaps;var c=b.length;for(var a=0;a<c;a++){if(b[a].preload&&!b[a].loaded){return false}}return true};b5.Scene.prototype.countResourcesNeedLoading=function(){var d=0;var b=this.bitmaps;var c=b.length;for(var a=0;a<c;a++){if(b[a].preload){d++}}b=this.sounds;c=b.length;for(a=0;a<c;a++){if(b[a].preload){d++}}return d};"use strict";b5.Xoml=function(a){this.current_scene=null;this.app=a};b5.Xoml.prototype.parseScene=function(d,e){if(this.app.debug){console.log("Parsing Scene "+e.Name)}var g=new b5.Scene();if(d!==null){d.addScene(g);if(e.Current){d.focus_scene=g}else{if(e.Current2){d.focus_scene2=g}}}this.current_scene=g;g.name=e.Name;if(e.Tag!==undefined){g.tag=e.Tag}g.x=e.Position[0];g.y=e.Position[1];if(e.CanvasSize!==undefined){g.w=e.CanvasSize[0];g.h=e.CanvasSize[1]}if(e.Layer!==undefined){g.layer=e.Layer}if(e.Visible!==undefined){g.visible=e.Visible}if(e.Active!==undefined){g.active=e.Active}if(e.Physics!==undefined&&e.Physics){g.initWorld(e.Gravity[0],e.Gravity[1],e.DoSleep);if(e.PhysicsTimestep!==undefined){g.time_step=e.PhysicsTimestep}if(e.WorldScale!==undefined){g.world_scale=e.WorldScale}}if(e.ClipChildren!==undefined){g.clip_children=e.ClipChildren}if(e.TouchPan==="Both"){g.touch_pan_x=true;g.touch_pan_y=true}else{if(e.TouchPan==="X"){g.touch_pan_x=true}else{if(e.TouchPan==="Y"){g.touch_pan_y=true}}}g.extents[0]=e.Extents[0];g.extents[1]=e.Extents[1];g.extents[2]=e.Extents[2];g.extents[3]=e.Extents[3];g.follow_speedx=e.FollowSpeed[0];g.follow_speedy=e.FollowSpeed[1];var b=e.UserProps;if(b!==undefined){for(var c=0;c<b.length;c++){g[b[c].N]=b[c].V}}var a=e.TimelineCollection;if(a!==undefined){for(var c=0;c<a.length;c++){this.parseTimeline(g,a[c])}}var f=e.ActionsList;if(f!==undefined){for(var c=0;c<f.length;c++){this.parseActionsList(g,f[c])}}if(e.Alpha!==undefined){g.opacity=e.Alpha}if(!(e.Cn===undefined)){this.parseResources(g,e.Cn)}if(e.ClipShape!==undefined&&e.ClipShape!==""){g.clip_shape=g.findResource(e.ClipShape,"shape")}if(e.TargetX!==""){g.target_x=g.findActor(e.TargetX)}if(e.TargetY!==""){g.target_y=g.findActor(e.TargetY)}if(e.VelocityDamping!==undefined){g.vx_damping=e.VelocityDamping[0];g.vy_damping=e.VelocityDamping[1]}if(e.OnCreate!==undefined){g.onCreate=Function(e.OnCreate)}if(e.OnDestroy!==undefined){g.onDestroy=Function(e.OnDestroy)}if(e.OnTick!==undefined){g.onTick=Function("dt",e.OnTick)}if(e.OnTapped!==undefined){g.onTapped=Function("touch_pos",e.OnTapped)}if(e.OnBeginTouch!==undefined){g.onBeginTouch=Function("touch_pos",e.OnBeginTouch)}if(e.OnEndTouch!==undefined){g.onEndTouch=Function("touch_pos",e.OnEndTouch)}if(e.OnMoveTouch!==undefined){g.onMoveTouch=Function("touch_pos",e.OnMoveTouch)}if(e.OnKeyPress!==undefined){g.onKeyPress=Function("e",e.OnKeyPress)}if(e.OnKeyDown!==undefined){g.onKeyDown=Function("e",e.OnKeyDown)}if(e.OnKeyUp!==undefined){g.onKeyUp=Function("e",e.OnKeyUp)}if(g.onCreate!==undefined){g.onCreate()}return g};b5.Xoml.prototype.parseBrush=function(h,j){if(this.app.debug){console.log("Parsing Brush "+j.N)}var c;if(j.BT===0){var e=j.RC;var g=h.findResource(j.I,"bitmap");var b=j.F;if(b.length===0){c=new b5.ImageAtlas(j.N,g,e[0],e[1],e[2],e[3],e[4],e[5])}else{c=new b5.ImageAtlas(j.N,g);for(var k=0;k<b.length;k++){var a=b[k];c.addFrame(a[0],a[1],a[2],a[3],a[5],a[6])}}var f=j.AN;if(f!==undefined&&f.length!==0){for(var k=0;k<f.length;k++){c.addAnim(f[k].N,f[k].F,f[k].S)}}}else{var i=j.ST;c=new b5.Gradient(j.N);for(var k=0;k<i.length;k++){var d=i[k];c.addColourStop(d.c,d.o)}if(j.Angle!==undefined){c.angle=j.Angle}}h.addResource(c,"brush");return c};b5.Xoml.prototype.parseImage=function(a,b){if(this.app.debug){console.log("Parsing Image "+b.N)}var c=new b5.Bitmap(b.N,b.Loc,b.P);a.addResource(c,"bitmap");return c};b5.Xoml.prototype.parseSound=function(a,b){if(this.app.debug){console.log("Parsing Sound "+b.N)}var c=new b5.Sound(b.N,b.Loc,b.R);if(b.P!==undefined){c.preload=b.P==1}if(b.A!==undefined){c.auto_play=b.A==1}if(b.Loc2!==undefined){c.location2=b.Loc2}if(b.L!==undefined){c.loop=b.L==1}if(c.preload){c.load()}a.addResource(c,"sound");return c};b5.Xoml.prototype.parseFont=function(a,b){if(this.app.debug){console.log("Parsing Font "+b.Name)}};b5.Xoml.prototype.parseShape=function(f,g){if(this.app.debug){console.log("Parsing Shape "+g.N)}var d=new b5.Shape(g.N);d.width=g.W;d.height=g.H;if(g.ST==="Circle"){d.type=b5.Shape.TypeCircle}else{if(g.ST==="Box"){d.type=b5.Shape.TypeBox}else{if(g.ST==="Polygon"){d.type=b5.Shape.TypePolygon;var c=g.V;var b=c.length;for(var h=0;h<b;h++){d.vertices.push(c[h])}if(g.CV!==undefined){var e=g.CV.length;for(var h=0;h<e;h++){var a=[];var c=g.CV[h];b=c.length;for(var i=0;i<b;i++){a.push(c[i])}d.convexVertices.push(a)}}}}}f.addResource(d,"shape");return d};b5.Xoml.prototype.parseMaterial=function(b,c){if(this.app.debug){console.log("Parsing Material "+c.N)}var a=new b5.Material();a.name=c.N;a.type=c.MT;a.density=c.D;a.friction=c.F;a.restitution=c.R;a.gravity_scale=c.GS;a.fixed_rotation=c.FR;a.is_bullet=c.IB;b.addResource(a,"material");return a};b5.Xoml.prototype.parseTimeline=function(f,h){var g=new b5.Timeline();if(h.N!==undefined){g.name=h.N}var d=h.A.length;for(var i=0;i<d;i++){var a=h.A[i];var b=new b5.Animation(g,f,a.P,a.V,a.TI,0,a.E);if(a.T!==undefined){b.tween=a.T}if(a.D!==undefined){b.destroy=a.D}if(a.R!==undefined){b.repeat=a.R}b.repeats_left=b.repeat;if(a.TS!==undefined){b.time_scale=a.TS}if(a.DE!==undefined){b.time=-a.DE}if(a.A===false){b.pause()}if(a.OnE!==undefined){b.onEnd=Function(a.OnE)}if(a.OnR!==undefined){b.onRepeat=Function(a.OnR)}if(a.AC!==undefined){for(var c=0;c<a.AC.length;c++){if(a.Actions[c]!==""){var e=a.AC[c];b.setAction(c,Function(e))}}}g.anims.push(b)}f.timelines.add(g)};b5.Xoml.prototype.parseActionsList=function(c,e){var g=new b5.ActionsList();if(e.N!==undefined){g.name=e.N}if(e.R!==undefined){g.repeats_left=e.R;g.repeat=e.R}g.destroy=false;var h=e.A;var d=h.length;for(var b=0;b<d;b++){var f;var a=h[b][0];if(a==="Custom"){a=h[b][1];h[b].splice(0,1)}f=b5.ActionsRegister.create(a,h[b]);g.actions.push(f)}if(e.P!==undefined&&e.P){g.play()}c.actions.add(g)};b5.Xoml.prototype.parseActor=function(e,j,r){var c=null;e.scene=this.current_scene;if(r.N!==undefined){e.name=r.N}if(r.T!==undefined){e.tag=r.T}if(r.V!==undefined){e.visible=r.V}if(r.Ac!==undefined){e.active=r.Ac}if(r.L!==undefined){e.layer=r.L}if(r.P!==undefined){e.x=r.P[0];e.y=r.P[1]}if(r.S!==undefined){e.scale_x=r.S[0];e.scale_y=r.S[1]}if(r.FX!==undefined&&r.FX){e.scale_x=-e.scale_x}if(r.FY!==undefined&&r.FY){e.scale_y=-e.scale_y}if(r.Or!==undefined){e.orphaned=r.Or}if(r.A!==undefined){e.rotation=r.A}if(r.C!==undefined){e.fill_style=r.C}if(r.SC!==undefined){e.stroke_style=r.SC}if(r.F!==undefined){e.filled=r.F}if(r.Th!==undefined){e.stroke_thickness=r.Th}if(r.Sz!==undefined){e.w=r.Sz[0];e.h=r.Sz[1];e.ow=r.Sz[0];e.oh=r.Sz[1]}if(r.O!==undefined){e.ox=r.O[0];e.oy=r.O[1]}if(e.ox<=-1||e.ox>=1||e.oy<=-1||e.oy>=1){e.absolute_origin=true}if(r.Al!==undefined){e.opacity=r.Al}if(r.UPO!==undefined){e.use_parent_opacity=r.UPO}if(r.D!==undefined){e.depth=r.D}e.use_transform=true;if(r.Ve!==undefined){e.vx=r.Ve[0];e.vy=r.Ve[1]}if(r.AV!==undefined){e.vr=r.AV}if(r.VD!==undefined){e.vx_damping=r.VD[0];e.vy_damping=r.VD[1]}if(r.AVD!==undefined){e.vr_damping=r.AVD}if(r.WP!==undefined){e.wrap_position=r.WP}if(r.IC!==undefined){e.ignore_camera=r.IC}if(r.CC!==undefined){e.clip_children=r.CC}if(r.To!==undefined){e.touchable=r.To}if(r.Bu!==undefined){e.bubbling=r.Bu}if(r.Do!==undefined){var a=r.Do;if(a==="top"||a==="topleft"||a==="topright"){e.dock_y=b5.Actor.Dock_Top}else{if(a==="bottom"||a==="bottomleft"||a==="bottomright"){e.dock_y=b5.Actor.Dock_Bottom}}if(a==="left"||a==="topleft"||a==="bottomleft"){e.dock_x=b5.Actor.Dock_Left}else{if(a==="right"||a==="topright"||a==="bottomright"){e.dock_x=b5.Actor.Dock_Right}}}if(r.M!==undefined){e.margin[0]=r.M[0];e.margin[1]=r.M[1];e.margin[2]=r.M[2];e.margin[3]=r.M[3]}if(r.CM!==undefined){e.clip_margin[0]=r.CM[0];e.clip_margin[1]=r.CM[1];e.clip_margin[2]=r.CM[2];e.clip_margin[3]=r.CM[3]}if(r.Sh!==undefined){e.shadow=r.Sh}if(r.ShO!==undefined){e.shadow_x=r.ShO[0];e.shadow_y=r.ShO[1]}if(r.ShB!==undefined){e.shadow_blur=r.ShB}if(r.ShC!==undefined){e.shadow_colour=r.ShC}if(r.CO!==undefined){e.composite_op=r.CO}if(r.BG!==undefined){c=this.current_scene.findResource(r.BG,"brush");if(c.stops!==undefined){var p={x:0,y:0};var s={x:0,y:1};if(r.GS!==undefined){p.x=r.GS[0];p.y=r.GS[1]}if(r.GE!==undefined){s.x=r.GE[0];s.y=r.GE[1]}var h=c.createStyle(e.w,e.h,p,s);if(e.filled){e.fill_style=h}else{e.stroke_style=h}}else{e.atlas=c}}if(r.DA!==undefined&&c!==null){e.playAnim(r.DA)}if(r.RA===3){var l=r.TX;var k=r.TY;e.map_width=r.MW;e.map_height=r.MH;e.tile_width=r.TW;e.tile_height=r.TH;e.display_width=r.DW;e.display_height=r.DH;e.map=r.Map;e.collision_map=r.CMap;e.generateTiles(l*k,e.tile_width,e.tile_height,e.tile_width*l)}if(j!==null){j.addActor(e)}if(r.OnC!==undefined){e.onCreate=Function(r.OnC)}if(r.OnD!==undefined){e.onDestroy=Function(r.OnD)}if(r.OnTi!==undefined){e.onTick=Function("dt",r.OnTi)}if(r.OnT!==undefined){e.touchable=true;e.onTapped=Function("touch_pos",r.OnT)}if(r.OnB!==undefined){e.touchable=true;e.onBeginTouch=Function("touch_pos",r.OnB)}if(r.OnE!==undefined){e.touchable=true;e.onEndTouch=Function("touch_pos",r.OnE)}if(r.OnM!==undefined){e.touchable=true;e.onMoveTouch=Function("touch_pos",r.OnM)}if(r.OnL!==undefined){e.touchable=true;e.onLostTouchFocus=Function("touch_pos",r.OnL)}if(r.OnCS!==undefined){e.onCollisionStart=Function("contact",r.OnCS)}if(r.OnCE!==undefined){e.onCollisionEnd=Function("contact",r.OnCE)}var o=r.UP;if(o!==undefined){for(var n=0;n<o.length;n++){e[o[n].N]=o[n].V}}var u=r.Fxs;if(u!==undefined){for(var n=0;n<u.length;n++){var f={};var m=null;var b=null;if(u[n].M!==undefined&&u[n].M!==""){m=this.current_scene.findResource(u[n].M,"material")}if(u[n].S!==undefined&&u[n].S!==""){b=this.current_scene.findResource(u[n].S,"shape")}if(n===0){e.initBody(m.type,m.fixed_rotation,m.is_bullet)}if(b===null){if(r.RA===1){f.type=b5.Shape.TypeCircle;f.width=e.w/2}else{f.type=b5.Shape.TypeBox;f.width=e.w;f.height=e.h}}else{f.shape=b}if(m!==null){f.material=m}f.is_sensor=u[n].R;if(u[n].C!==undefined){f.collision_category=u[n].C[0];f.collision_mask=u[n].C[1];f.collision_group=u[n].C[2]}e.addFixture(f)}}var v=r.Jts;if(v!==undefined){for(var n=0;n<v.length;n++){var f=[];var g=this.current_scene.findActor(v[n].AB);f.type=v[n].T;f.actor_b=g;f.anchor_a={x:v[n].OA[0],y:v[n].OA[1]};f.anchor_b={x:v[n].OB[0],y:v[n].OB[1]};f.self_collide=v[n].SC;f.damping=v[n].D;f.frequency=v[n].F;f.limit_joint=v[n].LJ;f.lower_limit=v[n].LL;f.upper_limit=v[n].UL;f.motor_enabled=v[n].ME;f.motor_speed=v[n].MS;f.max_motor_torque=v[n].MT;f.max_motor_force=v[n].MF;f.ground_a={x:v[n].GA[0],y:v[n].GA[1]};f.ground_b={x:v[n].GB[0],y:v[n].GB[1]};f.axis={x:v[n].A[0],y:v[n].A[1]};f.ratio=v[n].R;e.addJoint(f)}}var i=r.TC;if(i!==undefined){for(var n=0;n<i.length;n++){this.parseTimeline(e,i[n])}}var q=r.AL;if(q!==undefined){for(var n=0;n<q.length;n++){this.parseActionsList(e,q[n])}}if(e.body!==null){var d=Box2D.Common.Math.b2Vec2;e.body.SetLinearVelocity(new d(e.vx,e.vy));e.body.SetAngularVelocity(e.vr);e.body.SetLinearDamping(e.vx_damping);e.body.SetAngularDamping(e.vr_damping)}if(r.Cn!==undefined){this.parseResources(e,r.Cn)}return e};b5.Xoml.prototype.parseIcon=function(d,e){if(this.app.debug){console.log("Parsing Icon "+e.N)}var c;var b=0;if(e.RA!==undefined){b=e.RA}if(b===1){c=new b5.ArcActor()}else{if(b===2){c=new b5.RectActor()}else{if(b===3){c=new b5.MapActor()}else{if(b===0){if(e.Geo!==undefined){c=new b5.PolygonActor();var a=this.current_scene.findResource(e.Geo,"shape");if(a!==null){c.points=a.vertices}}else{c=new b5.Actor()}}}}}if(e.CR!==undefined){c.corner_radius=e.CR}this.parseActor(c,d,e);if(b===1){c.radius=c.w/2}if(e.Vi!==undefined&&e.Vi){c.makeVirtual();if(e.SR!==undefined){c.scroll_range[0]=e.SR[0];c.scroll_range[1]=e.SR[1];c.scroll_range[2]=e.SR[2];c.scroll_range[3]=e.SR[3]}if(e.SPos!==undefined){c.scroll_pos_x=e.SPos[0];c.scroll_pos_y=e.SPos[1]}}if(e.IAS!==undefined){c.ignore_atlas_size=e.IAS}if(e.SCl!==undefined){c.self_clip=e.SCl}if(e.CS!==undefined){c.clip_shape=this.current_scene.findResource(e.CS,"shape")}if(e.Ca===true){c.cache=true}if(e.Me===true){c.merge_cache=true}if(e.Rd===true){c.round_pixels=true}if(c.onCreate!==undefined){c.onCreate()}return c};b5.Xoml.prototype.parseLabel=function(b,c){if(this.app.debug){console.log("Parsing Label "+c.N)}var a=new b5.LabelActor();a.text=c.Text;a.font=c.Font;a.text_align=c.AlignH;a.text_baseline=c.AlignV;this.parseActor(a,b,c);if(c.Ca===true){a.cache=true}if(c.Me===true){a.merge_cache=true}if(c.Rd===true){a.round_pixels=true}if(a.onCreate!==undefined){a.onCreate()}return a};b5.Xoml.prototype.parseResources=function(b,d){var c=d.length;for(var a=0;a<c;a++){this.parseResource(b,d[a])}};b5.Xoml.prototype.parseResource=function(b,c){var a=c.RT;if(a==="Scene"){return this.parseScene(b,c)}else{if(a==="Brush"){return this.parseBrush(b,c)}else{if(a==="Image"){return this.parseImage(b,c)}else{if(a==="Sound"){return this.parseSound(b,c)}else{if(a==="Font"){return this.parseFont(b,c)}else{if(a==="Shape"){return this.parseShape(b,c)}else{if(a==="Material"){return this.parseMaterial(b,c)}else{if(a==="Icon"){return this.parseIcon(b,c)}else{if(a==="Label"){return this.parseLabel(b,c)}}}}}}}}}return null};b5.Xoml.findResource=function(e,a,c){if(e.Cn!==undefined){e=e.Cn}var d=e.length;for(var b=0;b<d;b++){if(e[b].RT.toLowerCase()===c&&e[b].N===a){return e[b]}}return null};"use strict";b5.Maths=function(){};b5.Maths.mulMatrix=function(b,a){var n=a[0];var m=a[1];var l=a[2];var k=a[3];var j=a[4];var i=a[5];var h=b[0];var g=b[1];var f=b[2];var e=b[3];var d=b[4];var c=b[5];b[0]=n*h+l*g;b[1]=m*h+k*g;b[2]=n*f+l*e;b[3]=m*f+k*e;b[4]=n*d+l*c+j;b[5]=m*d+k*c+i};b5.Maths.preMulMatrix=function(b,a){var n=b[0];var m=b[1];var l=b[2];var k=b[3];var j=b[4];var i=b[5];var h=a[0];var g=a[1];var f=a[2];var e=a[3];var d=a[4];var c=a[5];b[0]=n*h+l*g;b[1]=m*h+k*g;b[2]=n*f+l*e;b[3]=m*f+k*e;b[4]=n*d+l*c+j;b[5]=m*d+k*c+i};b5.Maths.vecMulMatrix=function(b,e,d){var c=b*d[0]+e*d[2]+d[4];var a=b*d[1]+e*d[3]+d[5];return{x:c,y:a}};"use strict";b5.Display=function(a){this.canvas=a;this.cache_ctx=null;this.context=a.getContext("2d");this.context.lineWidth=1;this.context.strokeStyle="black";this.context.fillStyle="black";this.context.globalAlpha=1;this.context.lineJoin="round";this.context.lineCap="round"};b5.Display.getWidth=function(){return document.documentElement.clientWidth};b5.Display.getHeight=function(){return document.documentElement.clientHeight};b5.Display.prototype.getCanvasPoint=function(b,a){var d=b5.app;var c=d.canvas_scale;return{x:(b-this.canvas.offsetLeft-d.canvas_cx)/c,y:(a-this.canvas.offsetTop-d.canvas_cy)/c}};b5.Display.prototype.clear=function(c){var b=b5.app;var a=this.context;a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,b.display_width,b.display_height)};b5.Display.prototype.drawPolygon=function(a,g,d,f){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}var e=d.length;b.beginPath();b.moveTo(d[0]+a,d[1]+g);for(var c=2;c<e;c+=2){b.lineTo(d[c]+a,d[c+1]+g)}if(f){b.fill()}else{b.lineTo(d[0]+a,d[1]+g);b.stroke()}return this};b5.Display.prototype.drawLine=function(c,e,b,d){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.beginPath();a.moveTo(c,e);a.lineTo(b,d);a.stroke();return this};b5.Display.prototype.drawRect=function(a,f,c,d,e){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}if(e){b.fillRect(a,f,c,d)}else{b.strokeRect(a,f,c,d)}return this};b5.Display.prototype.drawRoundRect=function(b,g,d,e,a,f){var c=this.context;if(this.cache_ctx!==null){c=this.cache_ctx}c.beginPath();c.moveTo(b+a,g);c.lineTo(b+d-a,g);c.quadraticCurveTo(b+d,g,b+d,g+a);c.lineTo(b+d,g+e-a);c.quadraticCurveTo(b+d,g+e,b+d-a,g+e);c.lineTo(b+a,g+e);c.quadraticCurveTo(b,g+e,b,g+e-a);c.lineTo(b,g+a);c.quadraticCurveTo(b,g,b+a,g);c.closePath();if(f){c.fill()}else{c.stroke()}};b5.Display.prototype.drawArc=function(b,g,a,d,f,e){var c=this.context;if(this.cache_ctx!==null){c=this.cache_ctx}c.beginPath();c.arc(b,g,a,d,f);if(e){c.fill()}else{c.stroke()}return this};b5.Display.prototype.drawAtlasImage=function(b,e,d,f,a,i,g,j,c){var k=this.context;if(this.cache_ctx!==null){k=this.cache_ctx}k.drawImage(b,e,d,f,a,i,g,j,c)};b5.Display.prototype.drawImage=function(e,a,f,c,d){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}if(c!==undefined){b.drawImage(e,a,f,c,d)}else{b.drawImage(e,a,f)}};b5.Display.prototype.drawText=function(d,a,e,c){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}if(c){b.fillText(d,a,e)}else{b.strokeText(d,a,e)}};b5.Display.prototype.setTransform=function(e,d,g,f,c,b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.setTransform(e,d,g,f,c,b)};b5.Display.prototype.clipRect=function(a,e,c,d){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}b.beginPath();b.rect(a,e,c,d);b.clip()};b5.Display.prototype.clipArc=function(b,f,a,e,d){var c=this.context;if(this.cache_ctx!==null){c=this.cache_ctx}c.beginPath();c.arc(b,f,a,e,d);c.clip()};b5.Display.prototype.clipPolygon=function(c){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.beginPath();var d=c.length;a.moveTo(c[0],c[1]);for(var b=2;b<d;b+=2){a.lineTo(c[b],c[b+1])}a.closePath();a.clip()};b5.Display.prototype.saveContext=function(){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.save()};b5.Display.prototype.restoreContext=function(){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.restore()};b5.Display.prototype.createCache=function(){return document.createElement("canvas")};b5.Display.prototype.setGlobalAlpha=function(a){this.context.globalAlpha=a};b5.Display.prototype.setGlobalCompositeOp=function(a){this.context.globalCompositeOperation=a};b5.Display.prototype.setShadow=function(a,e,c,d){var b=this.context;if(this.cache_ctx!==null){b=this.cache_ctx}b.shadowOffsetX=a;b.shadowOffsetY=e;b.shadowColor=c;b.shadowBlur=d};b5.Display.prototype.setShadowOff=function(){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.shadowColor="transparent"};b5.Display.prototype.setFillStyle=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.fillStyle=b};b5.Display.prototype.setStrokeStyle=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.strokeStyle=b};b5.Display.prototype.setLineWidth=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.lineWidth=b};b5.Display.prototype.setFont=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.font=b};b5.Display.prototype.setTextAlign=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.textAlign=b};b5.Display.prototype.setTextBaseline=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.textBaseline=b};b5.Display.prototype.setSmoothing=function(b){var a=this.context;if(this.cache_ctx!==null){a=this.cache_ctx}a.imageSmoothingEnabled=b;a.mozImageSmoothingEnabled=b;a.oImageSmoothingEnabled=b;a.imageSmoothingEnabled=b;a.msImageSmoothingEnabled=b};b5.Display.prototype.setCache=function(a){if(a===null){this.cache_ctx=null}else{this.cache_ctx=a.getContext("2d")}};"use strict";b5.Bitmap=function(c,a,b,e){this.image=new Image();this.parent=null;this.name=c;this.location=a;this.onload=e;this.preload=b;this.loaded=false;if(b){var d=this;this.image.onload=function(){b5.app.onResourceLoaded(d,false);if(e!==undefined){e(d)}};this.image.onerror=function(){b5.app.onResourceLoaded(d,true)};this.image.src=a}};b5.Bitmap.prototype.load=function(){var a=this;this.image.onload=function(){b5.app.onResourceLoaded(a,false);if(a.onload!==undefined){a.onload(a)}};this.image.onerror=function(){b5.app.onResourceLoaded(a,true)};this.image.src=this.location};b5.Bitmap.prototype.destroy=function(){this.image=null;if(this.parent!==null){this.parent.removeResource(this,"bitmap")}};"use strict";b5.Gradient=function(b,a){this.parent=null;if(a!==undefined){this.stops=a}else{this.stops=[]}this.name=b};b5.Gradient.prototype.addColourStop=function(a,b){this.stops.push({c:a,offs:b})};b5.Gradient.prototype.getColourStop=function(a){return this.stops[a]};b5.Gradient.prototype.getMaxStops=function(){return this.stops.length};b5.Gradient.prototype.destroy=function(){if(this.parent!==null){this.parent.removeResource(this,"brush")}};b5.Gradient.prototype.createStyle=function(j,e,b,d){if(this.stops!==undefined){var c=0,g=0;var a=1,f=0;if(b!==undefined){c=b.x;g=b.y}if(d!==undefined){a=d.x;f=d.y}c=c*j-j/2;g=g*e-e/2;a=a*j-j/2;f=f*e-e/2;var i=b5.app.display.context.createLinearGradient(c,g,a,f);for(var k=0;k<this.stops.length;k++){var l=this.stops[k];i.addColorStop(l.offs,l.c)}return i}return null};"use strict";b5.ImageAtlas=function(e,g,a,i,c,f,d,b){this.frames=[];this.anims=[];this.parent=null;this.name=e;this.bitmap=g;if(a!==undefined&&i!==undefined&&c!==undefined&&f!==undefined){this.addFrame(a,i,c,f,d,b)}};b5.ImageAtlas.prototype.addFrame=function(f,e,a,d,c,b){if(c===undefined){c=0}if(b===undefined){b=0}this.frames.push({x:f,y:e,w:a,h:d,ox:c,oy:b})};b5.ImageAtlas.prototype.getFrame=function(a){return this.frames[a]};b5.ImageAtlas.prototype.getMaxFrames=function(){return this.frames.length};b5.ImageAtlas.prototype.addAnim=function(a,c,b){this.anims[a]={indices:c,speed:b}};b5.ImageAtlas.prototype.getAnim=function(a){return this.anims[a]};b5.ImageAtlas.prototype.generate=function(k,i,a,g,j,h,e){if(e!==undefined){e=j*h}var b=i;for(var d=0;d<h;d++){var c=k;for(var f=0;f<j;f++){this.addFrame(c,b,a,g,0,0);c+=a;e--;if(e<=0){return}}b+=g}};b5.ImageAtlas.prototype.destroy=function(){if(this.parent!==null){this.parent.removeResource(this,"brush")}};"use strict";b5.Material=function(a){this.parent=null;this.name=a;this.type="static";this.density=1;this.friction=0.1;this.restitution=0.1;this.gravity_scale=1;this.fixed_rotation=false;this.is_bullet=false};b5.Material.prototype.destroy=function(){if(this.parent!==null){this.parent.removeResource(this,"material")}};"use strict";b5.Shape=function(a){this.parent=null;this.name=a;this.type=b5.Shape.TypeBox;this.width=0;this.height=0;this.vertices=[];this.convexVertices=[]};b5.Shape.TypeBox=0;b5.Shape.TypeCircle=1;b5.Shape.TypePolygon=2;b5.Shape.prototype.typeToConst=function(a){if(shape.type==="polygon"){return b5.Shape.TypePolygon}else{if(shape.type==="circle"){return b5.Shape.TypeCircle}}return b5.Shape.TypeBox};b5.Shape.prototype.remove=function(){if(this.parent!==null){this.parent.removeResource(this,"shape")}};"use strict";b5.Sound=function(b,a,c){this.parent=null;this.snd=null;this.buffer=null;this.name=b;this.location=a;this.location2=null;this.loop=false;if(c!==undefined){this.reuse=c}else{this.reuse=false}this.preload=false;this.loaded=false;this.auto_play=false};b5.Sound.context=null;b5.Sound.mp3_supported=false;b5.Sound.ogg_supported=false;b5.Sound.wav_supported=false;b5.Sound.init=function(b){b5.Sound.ogg_supported=new Audio().canPlayType("audio/ogg")!=="";b5.Sound.mp3_supported=new Audio().canPlayType("audio/mpeg")!=="";b5.Sound.wav_supported=new Audio().canPlayType("audio/wav")!=="";if(b.use_web_audio){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;if(window.AudioContext===undefined){return false}b5.Sound.context=new AudioContext()}catch(a){return false}return true}return false};b5.Sound.isSupported=function(a){var b=a.substr(a.lastIndexOf(".")+1);if(b==="ogg"&&b5.Sound.ogg_supported){return true}if(b==="mp3"&&b5.Sound.mp3_supported){return true}if(b==="wav"&&b5.Sound.wav_supported){return true}return false};b5.Sound.prototype.load=function(){var c=b5.app.debug;var a;var e=this;var b=this.location;var d=this.auto_play;if(!b5.Sound.isSupported(b)){b=this.location2;if(!b5.Sound.isSupported(b)){if(b5.app.debug){console.log("Warning: Unsupported audio formats");b5.app.onResourceLoaded(e,true)}return}}if(b5.app.use_web_audio){if(!b5.Utils.loadJSON(b,false,function(f){if(f!==null){b5.Sound.context.decodeAudioData(f,function(g){e.buffer=g;b5.app.onResourceLoaded(e,false);if(d){e.play()}},function(g){console.log(g)})}},true)){b5.app.onResourceLoaded(e,true)}}else{a=new Audio();if(this.loop){if(typeof a.loop==="boolean"){a.loop=true}else{a.addEventListener("ended",function(){this.currentTime=0;this.play()},false)}}a.onerror=function(){a.onerror=null;b5.app.onResourceLoaded(e,true)};a.oncanplaythrough=function(){a.oncanplaythrough=null;b5.app.onResourceLoaded(e,false);if(d){e.play()}};a.src=b}this.snd=a};b5.Sound.prototype.play=function(){if(b5.app.use_web_audio){if(this.buffer===null){return null}var b=b5.Sound.context;var d=b.createBufferSource();var c=b.createGain();d.buffer=this.buffer;d.loop=this.loop;d.connect(c);c.connect(b.destination);c.gain.value=1;d.start(0);if(this.auto_play){this.snd={source:d,gain:c}}return{source:d,gain:c}}var a=null;if(this.reuse){a=this.snd}if(a===null){if(!this.reuse){this.load();a=this.snd}}if(a!==null){a.play()}return a};b5.Sound.prototype.stop=function(){if(this.reuse&&this.snd!==null){this.snd.stop()}};b5.Sound.prototype.pause=function(){if(this.reuse&&this.snd!==null){this.snd.pause()}};b5.Sound.prototype.destroy=function(){};"use strict";b5.Utils=function(){};b5.Utils.loadJSON=function(a,c,g,f){var b=new XMLHttpRequest();b.open("GET",a,!c);if(f){b.responseType="arraybuffer"}if(!c){b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200||b.status===0){if(f){g(b.response)}else{g(b.responseText)}}else{g(null)}}}}try{b.send()}catch(d){return false}if(c){if(b.status===200){if(f){g(b.response)}else{g(b.responseText)}}else{g(null)}}return true};b5.Utils.loadJS=function(a){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);if(typeof b!=="undefined"){document.getElementsByTagName("head")[0].appendChild(b)}};b5.Utils.LogExtern=function(a,c){var b=new XMLHttpRequest();b.onreadystatechange=function(){if(c!=undefined&&b.readyState==4&&b.status==200){c(b.responseText)}};b.open("GET",a,true);b.send()};b5.Utils.findObjectFromPath=function(f,d){var g=f.split(".");var e=g.length;if(e===0){return null}var b=b5.app.findScene(g[0]);if(e===1&&d===undefined){return b}if(e>1){if(d===undefined){for(var a=1;a<e;a++){b=b.findActor(g[a])}return b}var h=d.charAt(0);if(h=="t"&&d==="timeline"){for(var a=1;a<e-1;a++){b=b.findActor(g[a])}if(b===null){return null}return b.timelines.find(g[e-1])}if(h=="a"&&d==="actions"){for(var a=1;a<e-1;a++){b=b.findActor(g[a])}if(b===null){return null}return b.actions.find(g[e-1])}}if(b5.app.debug){console.log("Warning: Could not resolve object for path '"+f+"'")}return null};b5.Utils.findResourceFromPath=function(e,c){var f=e.split(".");var d=f.length;if(d===0){return null}var b=b5.app;if(d>1){b=b5.app.findScene(e)}var a=b.findResource(f[d-1],c);if(a!==null){return a}if(b5.app.debug){console.log("Warning: Could not resolve resource for path '"+e+"'")}return null};b5.Utils.resolveObject=function(b,a){if(b===undefined){return null}if(typeof b==="string"){return b5.Utils.findObjectFromPath(b,a)}else{return b}};b5.Utils.resolveResource=function(b,a){if(b===undefined){return null}if(typeof b==="string"){return b5.Utils.findResourceFromPath(b,a)}else{return b}};b5.Utils.getResFromType=function(b,a){var d=a.charAt(0);if(d=="b"){if(a==="brush"){return b.brushes}else{if(a==="bitmap"){return b.bitmaps}}}else{if(d=="s"){if(a==="sound"){return b.sounds}else{if(a==="shape"){return b.shapes}}}else{if(d=="m"&&a==="material"){return b.materials}}}return null};b5.Utils.sortLayers=function(e){var b=e.length;var c,a;for(a=0;a<b;a++){for(c=a+1;c<b;c++){if(e[a].layer>e[c].layer){var d=e[a];e[a]=e[c];e[c]=d}}}};"use strict";b5.A_ChangeActions=function(b,a){this.actions=b;this.action=a};b5.A_ChangeActions.prototype.onInit=function(){this.actions=b5.Utils.resolveObject(this.actions,"actions");var b=this.actions;if(b!==null){var a=this.action;if(a==="play"){b.play()}else{if(a==="pause"){b.pause()}else{if(a==="restart"){b.restart()}}}}};b5.ActionsRegister.register("ChangeActions",function(a){return new b5.A_ChangeActions(a[1],a[2])});"use strict";b5.A_CreateExplosion=function(a,f,i,c,b,j,g,d,h,e){this.container=a;this.actor=e;this.count=f;this.type=i;this.duration=c;this.speed=b;this.spin_speed=j;this.rate=g;this.damping=d;this.properties=h};b5.A_CreateExplosion.prototype.onInit=function(){this.container=b5.Utils.resolveObject(this.container);this.actor=b5.Utils.resolveObject(this.actor);var a=new b5.ParticleActor();this.container.addActor(a);a.generateExplosion(this.count,this.type,this.duration,this.speed,this.spin_speed,this.rate,this.damping,this.properties);if(this.actor!==null){a._x=this.actor.x;a._y=this.actor.y;a._rotation=this.actor.rotation}};b5.ActionsRegister.register("CreateExplosion",function(a){return new b5.A_CreateExplosion(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10])});b5.A_CreatePlume=function(a,f,i,c,b,j,g,d,h,e){this.container=a;this.actor=e;this.count=f;this.type=i;this.duration=c;this.speed=b;this.spin_speed=j;this.rate=g;this.damping=d;this.properties=h};b5.A_CreatePlume.prototype.onInit=function(){this.container=b5.Utils.resolveObject(this.container);this.actor=b5.Utils.resolveObject(this.actor);var a=new b5.ParticleActor();this.container.addActor(a);a.generatePlume(this.count,this.type,this.duration,this.speed,this.spin_speed,this.rate,this.damping,this.properties);if(this.actor!==null){a._x=this.actor.x;a._y=this.actor.y;a._rotation=this.actor.rotation}};b5.ActionsRegister.register("CreatePlume",function(a){return new b5.A_CreatePlume(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10])});"use strict";b5.A_AttractX=function(d,b,g,a,f,i,c,e,h){this.target=d;this.container=b;this.min_x=g;this.max_x=a;this.min_y=f;this.max_y=i;this.strength=c;this.stop=e;this.bounce=h};b5.A_AttractX.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);this.container=b5.Utils.resolveObject(this.container);var f=this.target;var d=this.container.actors;var e=d.length;var k=f.x;var h=f.y;var j=this.min_x;var a=this.max_x;var i=this.min_y;var p=this.max_y;var b=this.strength;var g=this.stop;var o=this.bounce;for(var m=0;m<e;m++){var c=d[m];if(c.attract!==undefined){var l=c.y-h;if(l>i&&l<p){var n=k-c.x;if(n<j&&n>-j){if(g){if(c.x<k){c._x=k-j}else{if(c.x>k){c._x=k+j}}if(o){c.vx=-c.vx}else{c.vx=0}}}else{if(n>j&&n<a){c.vx+=b}else{if(n>-a&&n<-j){c.vx-=b}}}}}}return true};b5.ActionsRegister.register("AttractX",function(a){return new b5.A_AttractX(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9])});b5.A_AttractY=function(d,b,f,i,g,a,c,e,h){this.target=d;this.container=b;this.min_y=f;this.max_y=i;this.min_x=g;this.max_x=a;this.strength=c;this.stop=e;this.bounce=h};b5.A_AttractY.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);this.container=b5.Utils.resolveObject(this.container);var f=this.target;var d=this.container.actors;var e=d.length;var k=f.x;var h=f.y;var i=this.min_y;var p=this.max_y;var j=this.min_x;var a=this.max_x;var b=this.strength;var g=this.stop;var o=this.bounce;for(var m=0;m<e;m++){var c=d[m];if(c.attract!==undefined){var n=c.x-k;if(n>j&&n<a){var l=h-c.y;if(l<i&&l>-i){if(g){if(c.y<h){c._y=h-i}else{if(c.y>h){c._y=h+i}}if(o){c.vy=-c.vy}else{c.vy=0}}}else{if(l>i&&l<p){c.vy+=b}else{if(l>-p&&l<-i){c.vy-=b}}}}}}return true};b5.ActionsRegister.register("AttractY",function(a){return new b5.A_AttractY(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9])});b5.A_Attract=function(f,b,a,c,g,d,e){this.target=f;this.container=b;this.min_dist=a;this.max_dist=c;this.strength=g;this.stop=d;this.bounce=e};b5.A_Attract.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);this.container=b5.Utils.resolveObject(this.container);var h=this.target;var e=this.container.actors;var g=e.length;var m=h.x;var l=h.y;var i=this.min_dist;var f=this.max_dist;var b=this.strength;var k=this.stop;var q=this.bounce;var a=Math.sqrt(i);for(var o=0;o<g;o++){var c=e[o];if(c.attract!==undefined){var p=c.x-m;var n=c.y-l;var j=p*p+n*n;if(j>i&&j<f){j=Math.sqrt(j);c.vx-=b*p/j;c.vy-=b*n/j}else{if(j<i){j=Math.sqrt(j);if(k){c._x=m+a*p/j;c._y=l+a*n/j;if(q){c.vx=-c.vx;c.vy=-c.vy}else{c.vx=0;c.vy=0}}}}}}return true};b5.ActionsRegister.register("Attract",function(a){return new b5.A_Attract(a[1],a[2],a[3],a[4],a[5],a[6],a[7])});"use strict";b5.A_Sound=function(b,a){this.sound=b;this.action=a};b5.A_Sound.prototype.onInit=function(){this.sound=b5.Utils.resolveResource(this.sound,"sound");var b=this.sound;if(b!==null){var a=this.action;if(a==="play"){b.play()}else{if(a==="pause"){b.pause()}else{if(a==="stop"){b.stop()}}}}};b5.ActionsRegister.register("Sound",function(a){return new b5.A_Sound(a[1],a[2])});"use strict";b5.A_ChangeTimeline=function(a,b){this.timeline=a;this.action=b};b5.A_ChangeTimeline.prototype.onInit=function(){this.timeline=b5.Utils.resolveObject(this.timeline,"timeline");var a=this.timeline;if(a!==null){var b=this.action;if(b==="play"){a.play()}else{if(b==="pause"){a.pause()}else{if(b==="restart"){a.restart()}}}}};b5.ActionsRegister.register("ChangeTimeline",function(a){return new b5.A_ChangeTimeline(a[1],a[2])});"use strict";b5.A_Wait=function(a){this.duration=a};b5.A_Wait.prototype.onInit=function(){this.time=Date.now()};b5.A_Wait.prototype.onTick=function(){return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("Wait",function(a){return new b5.A_Wait(a[1])});b5.A_SetProps=function(b,a){this.target=b;this.properties=a};b5.A_SetProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var b=this.target;var a=this.properties;for(var c in a){b[c]=a[c]}};b5.ActionsRegister.register("SetProps",function(a){return new b5.A_SetProps(a[1],a[2])});b5.A_AddProps=function(b,a){this.target=b;this.properties=a};b5.A_AddProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var b=this.target;var a=this.properties;for(var c in a){b[c]+=a[c]}};b5.ActionsRegister.register("AddProps",function(a){return new b5.A_AddProps(a[1],a[2])});b5.A_TweenProps=function(d,b,f,a,c,e){this.target=d;this.props=b;this.start=f;this.end=a;this.duration=c;this.ease=e};b5.A_TweenProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now();var d=this.target;var b=this.props;var e=this.start;var c=b.length;for(var a=0;a<c;a++){d[b[a]]=e[a]}};b5.A_TweenProps.prototype.onTick=function(){var c=Date.now()-this.time;var a=this.duration;if(a!==0){var j=this.props;var b=this.start;var f=this.end;var g=j.length;var h=this.target;var e=this.ease;var i=c/(a*1000);if(i>1){i=1}for(var k=0;k<g;k++){h[j[k]]=b[k]+(f[k]-b[k])*b5.Ease.easingFuncs[e[k]](i)}}return(c<(a*1000))};b5.ActionsRegister.register("TweenProps",function(a){return new b5.A_TweenProps(a[1],a[2],a[3],a[4],a[5],a[6])});b5.A_Call=function(a,b){this.func=a;this.params=b};b5.A_Call.prototype.onInit=function(){window[this.func](this.params)};b5.ActionsRegister.register("Call",function(a){return new b5.A_Call(a[1],a[2])});b5.A_Create=function(d,e,c,b,a){this.objects=d;this.temp_name=c;this.type=b;this.scene=e;this.properties=a};b5.A_Create.prototype.onInit=function(){if(typeof this.objects==="string"){this.objects=b5.data[this.objects]}this.scene=b5.Utils.resolveObject(this.scene);var b=b5.Xoml.findResource(this.objects,this.temp_name,this.type);var d=new b5.Xoml(b5.app);d.current_scene=this.scene;var c=d.parseResource(this.scene,b);var a=this.properties;for(var e in a){c[e]=a[e]}};b5.ActionsRegister.register("Create",function(a){return new b5.A_Create(a[1],a[2],a[3],a[4],a[5])});b5.A_Destroy=function(a){this.target=a};b5.A_Destroy.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.target.destroy()};b5.ActionsRegister.register("Destroy",function(a){return new b5.A_Destroy(a[1])});b5.A_FocusScene=function(b,a){this.target=b;this.focus2=a};b5.A_FocusScene.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;if(this.focus2===true){b5.app.focus_scene2=a}else{b5.app.focus_scene=a}};b5.ActionsRegister.register("FocusScene",function(a){return new b5.A_FocusScene(a[1],a[2])});"use strict";b5.A_StopMove=function(e,b,a,d,c){this.target=e;this.stop_vx=b;this.stop_vy=a;this.stop_vr=d;this.duration=c};b5.A_StopMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_StopMove.prototype.onTick=function(){if(!((Date.now()-this.time)<(this.duration*1000))){var a=this.target;if(this.stop_vx){a.vx=0}if(this.stop_vy){a.vy=0}if(this.stop_vr){a.vr=0}return false}return true};b5.ActionsRegister.register("StopMove",function(a){return new b5.A_StopMove(a[1],a[2],a[3],a[4],a[5])});b5.A_Gravity=function(b,a,c){this.target=b;this.gravity_x=a;this.gravity_y=c};b5.A_Gravity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_Gravity.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;a.vx+=this.gravity_x;a.vy+=this.gravity_y;return false};b5.ActionsRegister.register("Gravity",function(a){return new b5.A_Gravity(a[1],a[2],a[3])});b5.A_Move=function(d,b,a,c){this.target=d;this.dx=b;this.dy=a;this.duration=c;this.x=d.x;this.y=d.y};b5.A_Move.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;if(this.dx!=null){a.vx=this.dx/this.duration}if(this.dy!=null){a.vy=this.dy/this.duration}this.time=Date.now()};b5.A_Move.prototype.onTick=function(){return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("Move",function(a){return new b5.A_Move(a[1],a[2],a[3],a[4])});b5.A_MoveTo=function(e,b,f,d,c,a){this.target=e;this.duration=d;this.x=b;this.y=f;this.sx=e.x;this.sy=e.y;this.ease_x=c||b5.Ease.linear;this.ease_y=a||b5.Ease.linear};b5.A_MoveTo.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;this.time=Date.now();this.sx=a.x;this.sy=a.y};b5.A_MoveTo.prototype.onTick=function(){var b=this.target;var a=Date.now()-this.time;var c=a/(this.duration*1000);if(c>1){c=1}if(this.x!=null){b._x=this.sx+(this.x-this.sx)*b5.Ease.easingFuncs[this.ease_x](c)}if(this.y!=null){b._y=this.sy+(this.y-this.sy)*b5.Ease.easingFuncs[this.ease_y](c)}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("MoveTo",function(a){return new b5.A_MoveTo(a[1],a[2],a[3],a[4],a[5],a[6])});b5.A_MoveWithSpeed=function(c,a,b,d){this.target=c;this.speed=a;this.duration=b;this.ease=d};b5.A_MoveWithSpeed.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now();if(this.duration===0){var c=this.target;var b=this.speed;var a=c.rotation;c.vx=b*Math.sin(a);c.vy=-b*Math.cos(a)}};b5.A_MoveWithSpeed.prototype.onTick=function(){var c=Date.now()-this.time;var b=this.duration;if(b!==0){var f=this.target;var a=f.rotation;var g=c/(b*1000);if(g>1){g=1}var e=this.speed*b5.Ease.easingFuncs[this.ease](g);f.vx=e*Math.sin(a);f.vy=-e*Math.cos(a)}return(c<(b*1000))};b5.ActionsRegister.register("MoveWithSpeed",function(a){return new b5.A_MoveWithSpeed(a[1],a[2],a[3],a[4])});b5.A_Follow=function(b,c,a,d){this.source=b;this.target=c;this.speed=a;this.distance=d};b5.A_Follow.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.source=b5.Utils.resolveObject(this.source)};b5.A_Follow.prototype.onTick=function(){var f=this.target;var e=this.source;var c=this.speed;var b=f.x-e.x;var a=f.y-e.y;var g=b*b+a*a;if(g<this.distance){e.vx=0;e.vy=0}else{e.vx=b/c;e.vy=a/c}return true};b5.ActionsRegister.register("Follow",function(a){return new b5.A_Follow(a[1],a[2],a[3],a[4])});b5.A_LookAt=function(c,d,a,b){this.source=c;this.target=d;this.lower=a;this.upper=b};b5.A_LookAt.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.source=b5.Utils.resolveObject(this.source)};b5.A_LookAt.prototype.onTick=function(){var d=this.target;var c=this.source;var e=Math.atan2(d.y-c.y,d.x-c.x)+Math.PI/2;var a=this.lower;if(a!==undefined&&e<a){e=a}var b=this.upper;if(b!==undefined&&e>b){e=b}c._rotation=e;return true};b5.ActionsRegister.register("LookAt",function(a){return new b5.A_LookAt(a[1],a[2],a[3],a[4])});b5.A_FollowPath=function(e,j,a,b,c){this.target=e;this.path=j;this.distance=a;this.speed=b;this.angle=c;var d=j.length>>1;var f=0;this.distances=[];this.angles=[];this.distances[0]=0;for(var h=1;h<d;h++){var i=j[h<<1]-j[(h-1)<<1];var g=j[(h<<1)+1]-j[((h-1)<<1)+1];f+=Math.sqrt(i*i+g*g);this.distances[h]=f;if(this.angle){this.angles[h-1]=Math.atan2(g,i)+Math.PI/2}}};b5.A_FollowPath.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_FollowPath.prototype.onTick=function(){var g=this.target;var m=this.path;var f=m.length>>1;var j=this.distances;var b=this.distance+this.speed;var n=j[f-1];while(b>=n){b-=n}while(b<0){b+=n}this.distance=b;for(var l=0;l<f;l++){if(b<j[l]){var e=l-1;if(e>=f){e=0}var c=m[e<<1];var a=m[l<<1];var k=m[(e<<1)+1];var i=m[(l<<1)+1];var h=(b-j[e])/(j[l]-j[e]);g._x=c+(a-c)*h;g._y=k+(i-k)*h;if(this.angle){g._rotation=this.angles[e]}break}}return true};b5.ActionsRegister.register("FollowPath",function(a){return new b5.A_FollowPath(a[1],a[2],a[3],a[4],a[5])});b5.A_FollowPathVel=function(f,k,a,c,b,d){this.target=f;this.path=k;this.distance=a;this.speed=c;this.angle=d;this.catchup_speed=b;var e=k.length>>1;var g=0;this.distances=[];this.distances[0]=0;for(var i=1;i<e;i++){var j=k[i<<1]-k[(i-1)<<1];var h=k[(i<<1)+1]-k[((i-1)<<1)+1];g+=Math.sqrt(j*j+h*h);this.distances[i]=g}};b5.A_FollowPathVel.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_FollowPathVel.prototype.onTick=function(){var g=this.target;var n=this.path;var f=n.length>>1;var k=this.distances;var b=this.distance+this.speed;var o=k[f-1];while(b>=o){b-=o}while(b<0){b+=o}this.distance=b;for(var m=0;m<f;m++){if(b<k[m]){var e=m-1;if(e>=f){e=0}var c=n[e<<1];var a=n[m<<1];var l=n[(e<<1)+1];var j=n[(m<<1)+1];var i=(b-k[e])/(k[m]-k[e]);var h=this.catchup_speed;g.vx=((c+(a-c)*i)-g.x)*h;g.vy=((l+(j-l)*i)-g.y)*h;if(this.angle){g._rotation=Math.atan2(g.vy,g.vx)+Math.PI/2}break}}return true};b5.ActionsRegister.register("FollowPathVel",function(a){return new b5.A_FollowPathVel(a[1],a[2],a[3],a[4],a[5],a[6])});b5.A_LimitMove=function(d,a,c,b){this.target=d;this.area=a;if(c==="bounce"){this.hit=0}else{if(c==="stop"){this.hit=1}else{if(c==="wrap"){this.hit=2}}}this.bounce=b};b5.A_LimitMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_LimitMove.prototype.onTick=function(){var f=this.target;var i=f.x;var h=f.y;var a=this.hit;var d=this.area;var k=this.bounce;if(d[2]!==0){var e=d[0];var c=e+d[2];if(i<e){if(a===0){f.vx=-f.vx*k}else{if(a===1){f.vx=0}else{if(a===2){f._x=c}}}}else{if(i>c){if(a===0){f.vx=-f.vx*k}else{if(a===1){f.vx=0}else{if(a===2){f._x=e}}}}}}if(d[3]!==0){var j=d[1];var g=j+d[3];if(h<j){if(a===0){f.vy=-f.vy*k}else{if(a===1){f.vy=0}else{if(a===2){f._y=g}}}}else{if(h>g){if(a===0){f.vy=-f.vy*k}else{if(a===1){f.vy=0}else{if(a===2){f._y=j}}}}}}return false};b5.ActionsRegister.register("LimitMove",function(a){return new b5.A_LimitMove(a[1],a[2],a[3],a[4])});"use strict";b5.A_CamStopMove=function(d,b,a,c){this.target=d;this.stop_vx=b;this.stop_vy=a;this.duration=c};b5.A_CamStopMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_CamStopMove.prototype.onTick=function(){if(!((Date.now()-this.time)<(this.duration*1000))){var a=this.target;if(this.stop_vx){a.camera_vx=0}if(this.stop_vy){a.camera_vy=0}return false}return true};b5.ActionsRegister.register("CamStopMove",function(a){return new b5.A_CamStopMove(a[1],a[2],a[3],a[4])});b5.A_CamGravity=function(b,a,c){this.target=b;this.gravity_x=a;this.gravity_y=c};b5.A_CamGravity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_CamGravity.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;a.camera_vx+=this.gravity_x;a.camera_vy+=this.gravity_y;return false};b5.ActionsRegister.register("CamGravity",function(a){return new b5.A_CamGravity(a[1],a[2],a[3])});b5.A_CamMove=function(d,b,a,c){this.target=d;this.dx=b;this.dy=a;this.duration=c;this.x=d.x;this.y=d.y};b5.A_CamMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;if(this.dx!=null){a.camera_vx=this.dx/this.duration}if(this.dy!=null){a.camera_vy=this.dy/this.duration}this.time=Date.now()};b5.A_CamMove.prototype.onTick=function(){return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("CamMove",function(a){return new b5.A_CamMove(a[1],a[2],a[3],a[4])});b5.A_CamMoveTo=function(e,b,f,d,c,a){this.target=e;this.duration=d;this.x=b;this.y=f;this.ease_x=c||b5.Ease.linear;this.ease_y=a||b5.Ease.linear};b5.A_CamMoveTo.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var a=this.target;this.time=Date.now();this.sx=a.camera_x;this.sy=a.camera_y};b5.A_CamMoveTo.prototype.onTick=function(){var b=this.target;var a=Date.now()-this.time;var c=a/(this.duration*1000);if(c>1){c=1}if(this.x!=null){b.camera_x=this.sx+(this.x-this.sx)*b5.Ease.easingFuncs[this.ease_x](c)}if(this.y!=null){b.camera_y=this.sy+(this.y-this.sy)*b5.Ease.easingFuncs[this.ease_y](c)}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("CamMoveTo",function(a){return new b5.A_CamMoveTo(a[1],a[2],a[3],a[4],a[5],a[6])});b5.A_CamFollow=function(b,c,a,d){this.source=b;this.target=c;this.speed=a;this.distance=d};b5.A_CamFollow.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.source=b5.Utils.resolveObject(this.source)};b5.A_CamFollow.prototype.onTick=function(){var f=this.target;var e=this.source;var c=this.speed;var b=f.x-e.camera_x;var a=f.y-e.camera_y;var g=b*b+a*a;if(g<this.distance){e.camera_vx=0;e.camera_vy=0}else{e.camera_vx=b/c;e.camera_vy=a/c}return true};b5.ActionsRegister.register("CamFollow",function(a){return new b5.A_CamFollow(a[1],a[2],a[3],a[4])});b5.A_CamFollowPath=function(d,h,a,b){this.target=d;this.path=h;this.distance=a;this.speed=b;var c=h.length>>1;var e=0;this.distances=[];this.distances[0]=0;for(var g=1;g<c;g++){var i=h[g<<1]-h[(g-1)<<1];var f=h[(g<<1)+1]-h[((g-1)<<1)+1];e+=Math.sqrt(i*i+f*f);this.distances[g]=e}};b5.A_CamFollowPath.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_CamFollowPath.prototype.onTick=function(){var g=this.target;var m=this.path;var f=m.length>>1;var j=this.distances;var b=this.distance+this.speed;var n=j[f-1];while(b>=n){b-=n}while(b<0){b+=n}this.distance=b;for(var l=0;l<f;l++){if(b<j[l]){var e=l-1;if(e>=f){e=0}var c=m[e<<1];var a=m[l<<1];var k=m[(e<<1)+1];var i=m[(l<<1)+1];var h=(b-j[e])/(j[l]-j[e]);g.camera_x=c+(a-c)*h;g.camera_y=k+(i-k)*h;break}}return true};b5.ActionsRegister.register("CamFollowPath",function(a){return new b5.A_CamFollowPath(a[1],a[2],a[3],a[4])});b5.A_CamFollowPathVel=function(e,j,a,c,b){this.target=e;this.path=j;this.distance=a;this.speed=c;this.catchup_speed=b;var d=j.length>>1;var f=0;this.distances=[];this.distances[0]=0;for(var h=1;h<d;h++){var i=j[h<<1]-j[(h-1)<<1];var g=j[(h<<1)+1]-j[((h-1)<<1)+1];f+=Math.sqrt(i*i+g*g);this.distances[h]=f}};b5.A_CamFollowPathVel.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_CamFollowPathVel.prototype.onTick=function(){var g=this.target;var n=this.path;var f=n.length>>1;var k=this.distances;var b=this.distance+this.speed;var o=k[f-1];while(b>=o){b-=o}while(b<0){b+=o}this.distance=b;for(var m=0;m<f;m++){if(b<k[m]){var e=m-1;if(e>=f){e=0}var c=n[e<<1];var a=n[m<<1];var l=n[(e<<1)+1];var j=n[(m<<1)+1];var i=(b-k[e])/(k[m]-k[e]);var h=this.catchup_speed;g.camera_vx=((c+(a-c)*i)-g.x)*h;g.camera_vy=((l+(j-l)*i)-g.y)*h;break}}return true};b5.ActionsRegister.register("CamFollowPathVel",function(a){return new b5.A_CamFollowPathVel(a[1],a[2],a[3],a[4],a[5])});b5.A_CamLimitMove=function(d,a,c,b){this.target=d;this.area=a;if(c==="bounce"){this.hit=0}else{if(c==="stop"){this.hit=1}else{if(c==="wrap"){this.hit=2}}}this.bounce=b};b5.A_CamLimitMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)};b5.A_CamLimitMove.prototype.onTick=function(){var f=this.target;var i=f.camera_x;var h=f.camera_y;var a=this.hit;var d=this.area;var k=this.bounce;if(d[2]!==0){var e=d[0];var c=e+d[2];if(i<e){if(a===0){f.camera_vx=-f.camera_vx*k}else{if(a===1){f.camera_vx=0}else{if(a===2){f.camera_x=c}}}}else{if(i>c){if(a===0){f.camera_vx=-f.camera_vx*k}else{if(a===1){f.camera_vx=0}else{if(a===2){f.camera_x=e}}}}}}if(d[3]!==0){var j=d[1];var g=j+d[3];if(h<j){if(a===0){f.camera_vy=-f.camera_vy*k}else{if(a===1){f.camera_vy=0}else{if(a===2){f.camera_y=g}}}}else{if(h>g){if(a===0){f.camera_vy=-f.camera_vy*k}else{if(a===1){f.camera_vy=0}else{if(a===2){f.camera_y=j}}}}}}return false};b5.ActionsRegister.register("CamLimitMove",function(a){return new b5.A_CamLimitMove(a[1],a[2],a[3],a[4])});"use strict";b5.A_SetLinearVelocity=function(d,b,a,c){this.target=d;this.vx=b;this.vy=a;this.duration=c};b5.A_SetLinearVelocity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_SetLinearVelocity.prototype.onTick=function(){var c=this.target;var a=c.body;if(a!==null){var b=Box2D.Common.Math.b2Vec2;a.SetAwake(true);a.SetLinearVelocity(new b(this.vx,this.vy))}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("SetLinearVelocity",function(a){return new b5.A_SetLinearVelocity(a[1],a[2],a[3],a[4])});b5.A_SetAngularVelocity=function(c,a,b){this.target=c;this.vr=a;this.duration=b};b5.A_SetAngularVelocity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_SetAngularVelocity.prototype.onTick=function(){var b=this.target;var a=b.body;if(a!==null){a.SetAwake(true);a.SetAngularVelocity(this.vr)}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("SetAngularVelocity",function(a){return new b5.A_SetAngularVelocity(a[1],a[2],a[3])});b5.A_ApplyForce=function(f,d,c,b,a,e){this.target=f;this.fx=d;this.fy=c;this.dx=b;this.dy=a;this.duration=e};b5.A_ApplyForce.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_ApplyForce.prototype.onTick=function(){var d=this.target;var a=d.body;if(a!==null){var b=d.scene.world_scale;var c=Box2D.Common.Math.b2Vec2;a.SetAwake(true);var e=a.GetWorldPoint(new c(this.dx/b,this.dy/b));a.ApplyForce(new c(this.fx,this.fy),e)}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("ApplyForce",function(a){return new b5.A_ApplyForce(a[1],a[2],a[3],a[4],a[5],a[6])});b5.A_ApplyImpulse=function(e,c,a,d,b){this.target=e;this.ix=c;this.iy=a;this.dx=d;this.dy=b};b5.A_ApplyImpulse.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var d=this.target;var a=d.body;if(a!==null){var b=d.scene.world_scale;var c=Box2D.Common.Math.b2Vec2;a.SetAwake(true);var e=a.GetWorldPoint(new c(this.dx/b,this.dy/b));a.ApplyImpulse(new c(this.ix,this.iy),e)}};b5.ActionsRegister.register("ApplyImpulse",function(a){return new b5.A_ApplyImpulse(a[1],a[2],a[2],a[3],a[4])});b5.A_ApplyTorque=function(c,a,b){this.target=c;this.torque=a;this.duration=b};b5.A_ApplyTorque.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);this.time=Date.now()};b5.A_ApplyTorque.prototype.onTick=function(){var b=this.target;var a=b.body;if(a!==null){a.SetAwake(true);a.ApplyTorque(this.torque)}return((Date.now()-this.time)<(this.duration*1000))};b5.ActionsRegister.register("ApplyTorque",function(a){return new b5.A_ApplyTorque(a[1],a[2],a[3])});